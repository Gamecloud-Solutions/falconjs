((function(){var Falcon,arrayContains,arrayPeek,arraysEqual,compact,countSubstrings,defer,delay,endsWith,extend,isArray,isEmpty,isFunction,isNumber,isObject,isString,objectKeys,objectValues,objectsEqual,startsWith,trim,trimSlashes,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__slice=Array.prototype.slice;isObject=function(a){return typeof a==typeof {}&&a!==null},isFunction=function(a){return Object.prototype.toString.call(a)==="[object Function]"},isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},isString=function(a){return Object.prototype.toString.call(a)==="[object String]"},isNumber=function(a){return Object.prototype.toString.call(a)==="[object Number]"},isEmpty=function(a){var b,c;if(isObject(a)){for(b in a)return c=a[b],!1;return!0}return isString(a||isArray(a))?a.length===0:a===null||typeof a=="undefined"?!0:!1},trim=function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},trimSlashes=function(a){return a.replace(/^\//,"").replace(/\/$/,"")},startsWith=function(a,b){return a.indexOf(b)===0},endsWith=function(a,b){return a.indexOf(b,a.length-b.length)!==-1},countSubstrings=function(a,b){return a.split(b).length-1},objectKeys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},objectValues=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(c);return d},objectsEqual=function(a,b){var c,d;for(c in a){d=a[c];if(b[c]!==d)return!1}for(c in b){d=b[c];if(a[c]!==d)return!1}return!0},compact=function(a){var b,c,d;isObject(a)||(a={}),c={};for(b in a)d=a[b],d!=null&&(c[b]=d);return c},extend=function(a,b){var c,d;a==null&&(a={}),isObject(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},arraysEqual=function(a,b){var c,d,e;if(a.length!==b.length)return!1;for(c=0,e=a.length;c<e;c++){d=a[c];if(b[c]!==d)return!1}return!0},arrayPeek=function(a){return a[a.length-1]},arrayContains=function(a,b){var c,d,e;if(isFunction(a.indexOf))return a.indexOf(b)!==-1;if(isArray(a))for(d=0,e=a.length;d<e;d++){c=a[d];if(c===b)return!0}return!1},delay=function(a,b){var c;return isFunction(a)&&(c=[b,a],a=c[0],b=c[1]),isNumber(a)||(a=1),isFunction(b)||(b=function(){}),a<1&&(a=1),setTimeout(b,a)},defer=function(a){return isFunction(a)||(a=function(){}),setTimeout(a,1)},Falcon={version:"0.0.0",observable:ko.observable,computed:ko.computed,attr:function(a){return ko.observable(a).extend({hasState:!0})},apply:function(){var a;return a=null,function(b){return a!=null?a:a=ko.observable(new b)}}()},this.Falcon=Falcon,$(function(){return ko.applyBindings()}),Falcon.Class=function(){function a(){}return a.prototype["super"]=function(){},a.extend=function(a,b){var c,d;return a==null&&(a=Falcon.Class),c=null,b!=null&&b.hasOwnProperty("constructor")?c=b.constructor:c=function(){return this.__super__.apply(this,arguments)},d=function(){},d.prototype=a.prototype,c.prototype=new d,c.prototype.__super__=function(){return a.apply(this,arguments)},c.extend=function(a){return Falcon.Class.extend(c,a)},extend(c.prototype,b!=null?b:{}),c},a}(),Falcon.Model=function(a){function b(a){var b;b=ko.utils.unwrapObservable(this.url),this.url=ko.observable(b),this.data(a)}return __extends(b,a),b.prototype._data={},b.prototype._id=null,b.prototype._url="",b.extend=function(a){return Falcon.Class.extend(Falcon.Model,a)},b.url=null,b.prototype.data=function(a){var b,c,d;if(isEmpty(a))return this._data;isObject(a)||(a={}),d=[];for(b in a)c=a[b],d.push(this.set(b,c));return d},b.prototype.get=function(a){if(!isString(a))return;return ko.utils.unwrapObservable(this._data[a])},b.prototype.set=function(a,b){var c;return b=ko.utils.unwrapObservable(b),(c=this._data)[a]==null&&(c[a]=ko.observable()),this._data[a](b),this},b.prototype.sync=function(a,b){var c;isFunction(b)&&(b={complete:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),isFunction(b.error)||(b.error=function(){}),isFunction(b.complete)||(b.complete=function(){}),a=isString(a)?a.toUpperCase():"GET",a!=="GET"&&a!=="POST"&&a!=="PUT"&&a!=="DELETE"&&(a="GET"),a=trim(a),c=trim(this.url());if(a==="GET"||a==="PUT"||a==="DELETE")c.slice(-1)!=="/"&&(c+="/"),c+=this.id();return $.ajax({url:this.url(),type:a,data:this.toJSON(),error:function(){return b.error.apply(b,arguments)},success:function(){return b.success.apply(b,arguments)},complete:function(){return b.complete.apply(b,arguments)}})},b.prototype.fetch=function(a){return this.sync("GET",a)},b.prototype.create=function(a){return this.sync("POST",a)},b.prototype.save=function(a){return this.sync("PUT",a)},b.prototype["delete"]=function(a){return this.sync("DELETE",a)},b.prototype.toJS=function(){var a;return(a=function(b){var c,d,e;b=ko.utils.unwrapObservable(b);if(isArray(b))return function(){var c,d,f;f=[];for(c=0,d=b.length;c<d;c++)e=b[c],f.push(a(e));return f}();if(isObject(b)){d={};for(c in b)e=b[c],d[c]=a(e);return d}return b})(this.data())},b.prototype.toJSON=function(){return ko.utils.stringifyJson(this.toJS())},b}(Falcon.Class),Falcon.View=function(a){function c(){var a,b,c,d=this;a=ko.utils.unwrapObservable(this.model),c=ko.utils.unwrapObservable(this.url),b=ko.utils.unwrapObservable(this.template),this.template=ko.observable(b).extend({throttle:1}),this.url=ko.observable(c).extend({throttle:1}),this.model=ko.observable(a),this.url.subscribe(function(){return d.getTemplateHtml()}()),this.initialize()}var b;return __extends(c,a),b={},c.extend=function(a){return Falcon.Class.extend(Falcon.View,a)},c.prototype.model=null,c.prototype.url=null,c.prototype.template=null,c.prototype.initialize=function(){},c.prototype.viewModel=function(){var a,b,c,d;d={},b=this.model(),b instanceof Falcon.Model&&(b=b.toJS());for(a in this)c=this[a],a in Falcon.View.prototype||(d[a]=c);return extend(d,b),d},c.prototype.getTemplateHtml=function(){var a,c=this;a=this.url(),isString(a)||(a=""),a=trim(a);if(isEmpty(a))return;return a in b?this.template(b[a]):$.ajax({url:a,type:"GET",success:function(d){return b[a]=d,c.template(d)}})},c}(Falcon.Class),ko.bindingHandlers.view=function(){var getTemplate,getViewModel,makeTemplateValueAccessor;return makeTemplateValueAccessor=function(a){return function(){return{"if":a,data:a,templateEngine:ko.nativeTemplateEngine.instance}}},getViewModel=function(a){var b,c;return b={},a instanceof Falcon.View?b=a.viewModel():b=ko.utils.unwrapObservable((c=a.viewModel)!=null?c:{}),b},getTemplate=function(a){var b,c;return b="",a instanceof Falcon.View?b=a.template():b=ko.utils.unwrapObservable((c=a.template)!=null?c:{}),b},{init:function(a,b){var c,d;return c=b(),c=ko.utils.unwrapObservable(c),d=getViewModel(c),ko.bindingHandlers.template.init(a,makeTemplateValueAccessor(d))},update:function(){var args,element,template,value,valueAccessor,viewModel;element=arguments[0],valueAccessor=arguments[1],args=3<=arguments.length?__slice.call(arguments,2):[],value=valueAccessor(),value=ko.utils.unwrapObservable(value),viewModel=getViewModel(value),template=getTemplate(value),console.log(template);if(isEmpty(template))return;if(isEmpty(viewModel))return;if(ko.utils.domData.get(element,"__ko_view_updating__")===!0)return;return ko.utils.domData.set(element,"__ko_view_updating__",!0),defer(function(){var execScripts,originalTemplate,_ref;return execScripts=!!ko.utils.unwrapObservable(value.execScripts),template==null?$(element).html(""):(originalTemplate=ko.utils.domData.get(element,"__ko_anon_template__"),ko.utils.domData.set(element,"__ko_anon_template__",template),(_ref=ko.bindingHandlers.template).update.apply(_ref,[element,makeTemplateValueAccessor(viewModel)].concat(__slice.call(args))),template!==originalTemplate&&execScripts===!0&&$(element).find("script").each(function(index,script){script=$(script);if(script.attr("type").toLowerCase()==="text/javascript")return eval(script.text())})),ko.utils.domData.set(element,"__ko_view_updating__",!1)})}}}(),extend(ko.extenders,{hasState:function(a,b){var c,d,e,f,g,h;return isObject(b)||(b={initial:a()}),e=(h=b.initial)!=null?h:a(),g=ko.observable(e),f=ko.observable(null),d=a(),c=ko.observable(!1),a.subscribe(function(a){return f(d),d=a,c(!0)}),extend(a,{initial:e,saved:g,previous:f,changed:c,save:function(){return g(d),c(!1),a},revert:function(){return a(g()),c(!1),a}}),a}})})).call(this)