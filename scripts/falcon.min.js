((function(){var Falcon,arrayContains,arrayPeek,arrayRemove,arrayUnique,arraysEqual,compact,countSubstrings,defer,delay,endsWith,extend,isArray,isBoolean,isEmpty,isFunction,isNumber,isObject,isString,key,objectKeys,objectValues,objectsEqual,startsWith,trim,trimSlashes,value,_foreach,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__slice=Array.prototype.slice;isObject=function(a){return typeof a==typeof {}&&a!==null},isFunction=function(a){return Object.prototype.toString.call(a)==="[object Function]"},isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"},isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},isString=function(a){return Object.prototype.toString.call(a)==="[object String]"},isNumber=function(a){return Object.prototype.toString.call(a)==="[object Number]"},isEmpty=function(a){var b,c;if(isObject(a)){for(b in a)return c=a[b],!1;return!0}return isString(a)||isArray(a)?a.length===0:a===null||typeof a=="undefined"?!0:!1},trim=function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},trimSlashes=function(a){return a.replace(/^\//,"").replace(/\/$/,"")},startsWith=function(a,b){return a.indexOf(b)===0},endsWith=function(a,b){return a.indexOf(b,a.length-b.length)!==-1},countSubstrings=function(a,b){return a.split(b).length-1},objectKeys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},objectValues=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(c);return d},objectsEqual=function(a,b){var c,d;for(c in a){d=a[c];if(b[c]!==d)return!1}for(c in b){d=b[c];if(a[c]!==d)return!1}return!0},compact=function(a){var b,c,d;isObject(a)||(a={}),c={};for(b in a)d=a[b],d!=null&&(c[b]=d);return c},extend=function(a,b){var c,d;a==null&&(a={}),isObject(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},arraysEqual=function(a,b){var c,d,e;if(a.length!==b.length)return!1;for(c=0,e=a.length;c<e;c++){d=a[c];if(b[c]!==d)return!1}return!0},arrayPeek=function(a){return a[a.length-1]},arrayContains=function(a,b){var c,d,e;if(isFunction(a.indexOf))return a.indexOf(b)!==-1;if(isArray(a))for(d=0,e=a.length;d<e;d++){c=a[d];if(c===b)return!0}return!1},arrayUnique=function(a){var b,c,d,e,f;c={};for(e=0,f=a.length;e<f;e++)b=a[e],c[b]=!0;return function(){var a;a=[];for(b in c)d=c[b],a.push(b);return a}()},arrayRemove=function(a,b){var c,d,e,f;if(!isArray(a))return[];isArray(b)||(b=[b]);for(d=0,f=b.length;d<f;d++)c=b[d],a=function(){var b,d,f;f=[];for(b=0,d=a.length;b<d;b++)e=a[b],e!==c&&f.push(e);return f}();return a},delay=function(a,b){var c;return isFunction(a)&&(c=[b,a],a=c[0],b=c[1]),isNumber(a)||(a=1),isFunction(b)||(b=function(){}),a<1&&(a=1),setTimeout(b,a)},defer=function(a){return isFunction(a)||(a=function(){}),setTimeout(a,1)},Falcon={version:"0.0.2",baseApiUrl:"",apply:function(a){return $(function(){return $("body").attr("data-bind","view: $data"),ko.applyBindings(a)})},isModel:function(a){return a=ko.utils.unwrapObservable(a),a!=null&&a instanceof Falcon.Model},isCollection:function(a){return a=ko.utils.unwrapObservable(a),a!=null&&a instanceof Falcon.Collection},isView:function(a){return a=ko.utils.unwrapObservable(a),a!=null&&a instanceof Falcon.View},isDataObject:function(a){return a=ko.utils.unwrapObservable(a),a!=null&&(a instanceof Falcon.Model||a instanceof Falcon.Collection)}},this.Falcon=Falcon,Falcon.Class=function(){function a(){}return a.prototype["super"]=function(){},a.extend=function(a,b){var c,d;return a==null&&(a=Falcon.Class),c=null,b!=null&&b.hasOwnProperty("constructor")?c=b.constructor:c=function(){return this.__super__.apply(this,arguments)},d=function(){},d.prototype=a.prototype,c.prototype=new d,c.prototype.__super__=function(){return a.apply(this,arguments)},c.extend=function(a){return Falcon.Class.extend(c,a)},extend(c.prototype,b!=null?b:{}),c},a}(),Falcon.Model=function(a){function b(a,b){var c,d,e,f,g;a=ko.utils.unwrapObservable(a),b=ko.utils.unwrapObservable(b),Falcon.isModel(a)&&b==null&&(f=[a,b],b=f[0],a=f[1]),this._events={},this.id=ko.observable(),this.parent=ko.utils.unwrapObservable(b),this.fields===null&&(this.fields=[]),this.initialize(a),this.fill(a),g=this.fields;for(d=0,e=g.length;d<e;d++)c=g[d],!this[c]&&isString(c)&&(this[c]=ko.observable())}return __extends(b,a),b.extend=function(a){return Falcon.Class.extend(Falcon.Model,a)},b.prototype.url=null,b.prototype.parent=null,b.prototype.fields=null,b.prototype._events=null,b.prototype.initialize=function(){},b.prototype.fill=function(a){var b,c;if(!isObject(a))return this;for(b in a)c=a[b],b in Falcon.Model.prototype||(this[b]==null?(!ko.isObservable(c)&&!Falcon.isDataObject(c)&&(isArray(c)?c=ko.observableArray(c):c=ko.observable(c)),this[b]=c):Falcon.isDataObject(this[b])?this[b].fill(c):ko.isObservable(this[b])?this[b](c):this[b]=c);return this},b.prototype.unwrap=function(){var a,b,c,d,e,f;c={},b=arrayRemove(objectKeys(this),objectKeys(Falcon.Model.prototype)),b[b.length]="id",b=arrayUnique(b);for(e=0,f=b.length;e<f;e++)a=b[e],d=this[a],c[a]=Falcon.isDataObject(d)?d.unwrap():d;return c},b.prototype.serialize=function(){var a,b,c,d,e,f;c={},isArray(this.fields)&&this.fields.length>0?b=this.fields:b=arrayRemove(objectKeys(this),objectKeys(Falcon.Model.prototype)),b[b.length]="id",b=arrayUnique(b);for(e=0,f=b.length;e<f;e++)a=b[e],d=this[a],Falcon.isDataObject(d)?c[a]=d.serialize():ko.isObservable(d)?c[a]=ko.utils.unwrapObservable(d):isFunction(d)||(c[a]=d);return c},b.prototype.makeUrl=function(a){var b,c,d,e,f;f=isFunction(this.url)?this.url():this.url,isString(f)||(f=""),f=trim(f),isString(a)||(a=""),a=a.toUpperCase(),a!=="GET"&&a!=="PUT"&&a!=="POST"&&a!=="DELETE"&&(a="GET"),b="",e=f.lastIndexOf("."),e>-1&&(b=f.slice(e),f=f.slice(0,e)),startsWith(f,"/")||(f="/"+f),Falcon.isModel(this.parent)?(d=this.parent.makeUrl(),c=d.lastIndexOf("."),c>-1&&(d=d.slice(0,c)),d=trim(d),f=""+d+f):isString(Falcon.baseApiUrl)&&(f=""+Falcon.baseApiUrl+f);if(a==="GET"||a==="PUT"||a==="DELETE")f.slice(-1)!=="/"&&(f+="/"),f+=this.id();return""+f+b},b.prototype.sync=function(a,b){var c,d,e=this;isFunction(b)&&(b={complete:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),isFunction(b.error)||(b.error=function(){}),isFunction(b.complete)||(b.complete=function(){}),a=trim(isString(a)?a.toUpperCase():"GET"),a!=="GET"&&a!=="POST"&&a!=="PUT"&&a!=="DELETE"&&(a="GET"),c={};if(a==="POST"||a==="PUT")c=JSON.stringify(this.serialize());return isObject(b.data)&&(c=extend(c,b.data)),d=this.makeUrl(a),$.ajax({url:d,type:a,data:c,dataType:"json",error:function(a){var c;c=a.responseText;try{isString(c)&&(c=JSON.parse(c))}catch(d){}return b.error.call(e,e,c,a)},success:function(c){var d;e.fill(c);switch(a){case"GET":e.trigger("fetch");break;case"POST":e.trigger("create");break;case"PUT":e.trigger("save");break;case"DELETE":e.trigger("destroy")}return(d=b.success).call.apply(d,[e,e].concat(__slice.call(arguments)))},complete:function(){var a;return(a=b.complete).call.apply(a,[e,e].concat(__slice.call(arguments)))}}),this},b.prototype.fetch=function(a){return this.sync("GET",a)},b.prototype.create=function(a){return this.sync("POST",a)},b.prototype.save=function(a){return this.sync("PUT",a)},b.prototype.destroy=function(a){return this.sync("DELETE",a)},b.prototype.map=function(a){var b,c,d=this;isObject(a)||(a={});for(b in a)c=a[b],Falcon.isDataObject(this[b])?this[b].map(c):ko.isObservable(c)?this[b]=ko.observable(ko.utils.unwrapObservable(c)):isFunction(c)?function(){var a;return a=c,d[b]=function(){return a.call(d,d)}}():this[b]=c;return this},b.prototype.on=function(a,b,c){var d,e;return!isString(a)||!isFunction(b)?this:(c==null&&(c=this),a=trim(a).toLowerCase(),isEmpty(a)?this:(((e=(d=this._events)[a])!=null?e:d[a]=[]).push({action:b,context:c}),this))},b.prototype.off=function(a,b){var c;return!isString(a)||!isFunction(b)?this:(a=trim(a).toLowerCase(),isEmpty(a)||this._events[a]==null?this:(this._events[a]=function(){var d,e,f,g;f=this._events[a],g=[];for(d=0,e=f.length;d<e;d++)c=f[d],c.action!==b&&g.push(c);return g}.call(this),this))},b.prototype.has=function(a,b){var c,d,e,f;if(!isString(a)||!isFunction(b))return!1;a=trim(a).toLowerCase();if(isEmpty(a)||this._events[a]==null)return!1;f=this._events[a];for(d=0,e=f.length;d<e;d++){c=f[d];if(c.action===b)return!0}return!1},b.prototype.trigger=function(a){var b,c,d,e;if(!isString(a))return this;a=trim(a).toLowerCase();if(isEmpty(a)||this._events[a]==null)return this;e=this._events[a];for(c=0,d=e.length;c<d;c++)b=e[c],b.action.call(b.context,this);return this},b}(Falcon.Class),Falcon.View=function(a){function c(){var a=this;this.template=ko.observable(ko.utils.unwrapObservable(this.template)),isString(this.url)||(this.url=""),this.url=trim(this.url),this._loaded=!1,isEmpty(this.url)?this._loaded=!0:this.url in b?(this._loaded=!0,this.template(b[this.url])):$.ajax({url:this.url,type:"GET",cache:!1,success:function(c){return b[a.url]=c,a.template(c),a._loaded=!0,a.load()}}),this.initialize()}var b;return __extends(c,a),b={},c.extend=function(a){return Falcon.Class.extend(Falcon.View,a)},c.prototype._loaded=!1,c.prototype._loadQueue=[],c.prototype.url=null,c.prototype.template=null,c.prototype.initialize=function(){},c.prototype.viewModel=function(){var a,b,c,d=this;c={__falcon__:!0};for(a in this){b=this[a];if(a in Falcon.View.prototype)continue;isFunction(b)&&!ko.isObservable(b)&&(b=function(){var a;return a=b,function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],a.call.apply(a,[d].concat(__slice.call(b)))}}()),c[a]=b}return c},c.prototype.isLoaded=function(){return this._loaded},c.prototype.load=function(a){if(a!=null)isFunction(a)||(a=function(){}),this._loaded?a.call(this):this._loadQueue.push(a);else if(this._loaded)while(!(this._loadQueue.length<=0))this._loadQueue.shift().call(this);return this},c}(Falcon.Class),Falcon.Collection=function(a){function b(a,b){var c,d=this;b==null&&Falcon.isModel(a)&&(c=[a,b],b=c[0],a=c[1]),this.model!=null&&this.url==null&&(this.url=this.model.prototype.url),this.parent=b,this.length=ko.observable(ko.utils.unwrapObservable(this.length)),this.populated=ko.computed(function(){return d.length()>0}),this._mappings=[],this.reset().fill(a),this.initialize(a)}return __extends(b,a),b.prototype.list=null,b.prototype.model=null,b.prototype.url=null,b.prototype.length=0,b.prototype.parent=null,b._mappings=null,b.extend=function(a){return Falcon.Class.extend(Falcon.Collection,a)},b.prototype.initialize=function(){},b.prototype.fill=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(this.model==null)return this;a==null&&(a=[]),Falcon.isCollection(a)&&(a=a.list()),ko.isObservable(a)&&(a=ko.utils.unwrapObservable(a)),isArray(a)||(a=[a]),b==null&&(b={}),isObject(b)||(b={}),g=b.method,isString(g)||(g=""),g=g.toLowerCase(),g!=="replace"&&g!=="append"&&g!=="prepend"&&(g="replace");for(c in a)e=a[c],e instanceof this.model||(a[c]=new this.model(e,this.parent));for(h=0,j=a.length;h<j;h++){d=a[h];if(Falcon.isDataObject(d)){l=this._mappings;for(i=0,k=l.length;i<k;i++)f=l[i],d.map(f)}}if(g==="replace")this.reset().list(a);else if(g==="prepend")while(a.length>0)this.list.unshift(a.pop());else if(g==="append")while(a.length>0)this.list.push(a.shift());return this.length(this.list().length),this},b.prototype.unwrap=function(){var a,b,c,d;b=[],d=this.list();for(a in d)c=d[a],b[a]=Falcon.isDataObject(c)?c.unwrap():c;return b},b.prototype.serialize=function(){var a,b,c,d;b=[],d=this.list();for(a in d)c=d[a],b[a]=Falcon.isDataObject(c)?c.serialize():c;return b},b.prototype.makeUrl=function(a){var b,c,d;return d=isFunction(this.url)?this.url():this.url,isString(d)||(d=""),d=trim(d),isString(a)||(a=""),a=a.toUpperCase(),a!=="GET"&&a!=="PUT"&&a!=="POST"&&a!=="DELETE"&&(a="GET"),startsWith(d,"/")||(d="/"+d),Falcon.isModel(this.parent)?(c=this.parent.makeUrl(),b=c.lastIndexOf("."),b>-1&&(c=c.slice(0,b)),c=trim(c),d=""+c+d):isString(Falcon.baseApiUrl)&&(d=""+Falcon.baseApiUrl+d),d},b.prototype.fetch=function(a){return this.sync("GET",a)},b.prototype.sync=function(a,b){var c,d,e,f=this;isFunction(b)&&(b={success:b}),isObject(b)||(b={}),isObject(b.data)||(b.data={}),isFunction(b.success)||(b.success=function(){}),isFunction(b.error)||(b.error=function(){}),a=isString(a)?a.toUpperCase():"GET",a!=="GET"&&a!=="POST"&&a!=="PUT"&&a!=="DELETE"&&(a="GET"),a=trim(a),c=(e=b.data)!=null?e:{},d=this.makeUrl(a);if(d==null||!isString(d))return;return $.ajax({url:trim(d),type:a,data:c,dataType:"json",success:function(){var d,e;return d=1<=arguments.length?__slice.call(arguments,0):[],c=(e=d[0])!=null?e:{},isString(c)&&(c=JSON.parse(c)),a==="GET"&&f.fill(c,b),b.success.apply(b,d)},error:b.error}),this},b.prototype.remove=function(a){return isArray(a)?this.list.removeAll(a):this.list.remove(a),this.length(this.list().length),this},b.prototype.append=function(a){return this.fill(a,{method:"append"})},b.prototype.prepend=function(a){return this.fill(a,{method:"prepend"})},b.prototype.create=function(a,b){var c,d=this;if(this.model==null)return;return isFunction(b)&&(b={success:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),c=b.success,b.success=function(a){return d.fill(a,b),c.apply(a,arguments)},(new this.model(a,this.parent)).create(b)},b.prototype.destroy=function(a,b){var c,d,e,f,g=this;if(this.model==null)return this;if(a==null||a==="all")a=this.list();Falcon.isCollection(a)&&(a=a.list()),isArray(a)||(a=[a]);if(isEmpty(a))return this;b={success:b}===isFunction(b),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),f=b.success,b.success=function(a){return g.remove(a),f.apply(a,arguments)};for(d=0,e=a.length;d<e;d++)c=a[d],Falcon.isDataObject(c)&&c.destroy(b);return this},b.prototype.at=function(a){var b;return isNumber(a)||(a=0),b=this.list(),a<0&&(a=0),a>=b.length&&(a=b.length-1),b[a]},b.prototype.first=function(){return this.list()[0]},b.prototype.last=function(){return this.list()[this.length-1]},b.prototype.map=function(a){var b,c,d,e,f,g,h,i=this;isObject(a)||(a={}),g={};for(b in a)d=a[b],ko.isObservable(d)?g[b]=ko.observable(ko.utils.unwrapObservable(d)):isFunction(d)?function(){var a;return a=d,g[b]=function(){return a.call(arguments[0],arguments[0],i)}}():g[b]=d;h=this.list();for(e=0,f=h.length;e<f;e++)c=h[e],Falcon.isDataObject(c)&&c.map(g);return this._mappings.push(g),this},b.prototype.reset=function(){return this.list==null&&(this.list=ko.observableArray([])),this.list([]),this.length(this.list().length),this},b}(Falcon.Class),ko.bindingHandlers.view=function(){var getTemplate,getViewModel,makeTemplateValueAccessor;return makeTemplateValueAccessor=function(a){return function(){return{"if":a,data:a,templateEngine:ko.nativeTemplateEngine.instance}}},getViewModel=function(a){var b,c;return b={},a==null&&(a={}),a instanceof Falcon.View?b=a.viewModel():b=ko.utils.unwrapObservable((c=a.viewModel)!=null?c:{}),b},getTemplate=function(a){var b,c;return b="",a==null&&(a={}),a instanceof Falcon.View?b=a.template():b=ko.utils.unwrapObservable((c=a.template)!=null?c:{}),b},{init:function(a,b){var c,d;return c=b(),c=ko.utils.unwrapObservable(c),d=getViewModel(c),ko.bindingHandlers.template.init(a,makeTemplateValueAccessor(d))},update:function(){var args,element,template,value,valueAccessor,viewModel;element=arguments[0],valueAccessor=arguments[1],args=3<=arguments.length?__slice.call(arguments,2):[],value=valueAccessor(),value=ko.utils.unwrapObservable(value),viewModel=getViewModel(value),template=getTemplate(value);if(isEmpty(template))return;if(isEmpty(viewModel))return;if(ko.utils.domData.get(element,"__ko_view_updating__")===!0)return;return ko.utils.domData.set(element,"__ko_view_updating__",!0),defer(function(){var execScripts,originalTemplate,_ref;return execScripts=!!ko.utils.unwrapObservable(value.execScripts),template==null?$(element).html(""):(originalTemplate=ko.utils.domData.get(element,"__ko_anon_template__"),ko.utils.domData.set(element,"__ko_anon_template__",template),(_ref=ko.bindingHandlers.template).update.apply(_ref,[element,makeTemplateValueAccessor(viewModel)].concat(__slice.call(args))),template!==originalTemplate&&execScripts===!0&&$(element).find("script").each(function(index,script){script=$(script);if(script.attr("type").toLowerCase()==="text/javascript")return eval(script.text())})),ko.utils.domData.set(element,"__ko_view_updating__",!1)})}}}(),_foreach=ko.bindingHandlers.foreach,ko.bindingHandlers.foreach=function(){var a;return a=function(a){return Falcon.isDataObject(a)&&(a=a.unwrap()),isArray(a)||(a=[a]),function(){return a}},{init:function(){var b,c,d,e;return c=arguments[0],e=arguments[1],b=3<=arguments.length?__slice.call(arguments,2):[],d=ko.utils.unwrapObservable(e()),_foreach.init.apply(_foreach,[c,a(d)].concat(__slice.call(b)))},update:function(){var b,c,d,e;return c=arguments[0],e=arguments[1],b=3<=arguments.length?__slice.call(arguments,2):[],d=ko.utils.unwrapObservable(e()),_foreach.update.apply(_foreach,[c,a(d)].concat(__slice.call(b)))}}}();for(key in _foreach)value=_foreach[key],key in ko.bindingHandlers.foreach||(ko.bindingHandlers.foreach[key]=value);ko.bindingHandlers.collection=ko.bindingHandlers.foreach})).call(this)