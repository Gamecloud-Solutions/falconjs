((function(){var $document,$window,Falcon,arrayContains,arrayPeek,arrayRemove,arrayUnique,arraysEqual,compact,countSubstrings,defer,delay,endsWith,extend,findKey,flattenObjectKeys,isArray,isBoolean,isEmpty,isFunction,isNumber,isObject,isString,key,objectKeys,objectValues,objectsEqual,startsWith,trim,trimSlashes,value,_bindingContext,_foreach,_getItems,_options,_ref,_ref2,_shouldUpdate,__slice=Array.prototype.slice,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};isObject=function(a){return a!=null&&Object.prototype.toString.call(a)==="[object Object]"},isFunction=function(a){return a!=null&&Object.prototype.toString.call(a)==="[object Function]"},isBoolean=function(a){return a!=null&&Object.prototype.toString.call(a)==="[object Boolean]"},isArray=function(a){return a!=null&&Object.prototype.toString.call(a)==="[object Array]"},isString=function(a){return a!=null&&Object.prototype.toString.call(a)==="[object String]"},isNumber=function(a){return a!=null&&Object.prototype.toString.call(a)==="[object Number]"},isEmpty=function(a){var b,c;if(isObject(a)){for(b in a)return c=a[b],!1;return!0}return isString(a)||isArray(a)?a.length===0:a===null||typeof a=="undefined"?!0:!1},trim=function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},trimSlashes=function(a){return a.replace(/^\//,"").replace(/\/$/,"")},startsWith=function(a,b){return a.indexOf(b)===0},endsWith=function(a,b){return a.indexOf(b,a.length-b.length)!==-1},countSubstrings=function(a,b){return a.split(b).length-1},objectKeys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},objectValues=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(c);return d},objectsEqual=function(a,b){var c,d;for(c in a){d=a[c];if(b[c]!==d)return!1}for(c in b){d=b[c];if(a[c]!==d)return!1}return!0},compact=function(a){var b,c,d;isObject(a)||(a={}),c={};for(b in a)d=a[b],d!=null&&(c[b]=d);return c},extend=function(a,b){var c,d;a==null&&(a={}),isObject(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},findKey=function(a,b){var c,d;for(c in a){d=a[c];if(d===b)return c}},flattenObjectKeys=function(a,b){var c,d,e;c=[],isString(b)||(b="");for(d in a)e=a[d],isObject(e)?c=c.concat(flattenObjectKeys(e,""+b+d+".")):c.push(""+b+d);return c},arraysEqual=function(a,b){var c,d,e;if(a.length!==b.length)return!1;for(c=0,e=a.length;c<e;c++){d=a[c];if(b[c]!==d)return!1}return!0},arrayPeek=function(a){return a[a.length-1]},arrayContains=function(a,b){var c,d,e;if(isFunction(a.indexOf))return a.indexOf(b)!==-1;if(isArray(a))for(d=0,e=a.length;d<e;d++){c=a[d];if(c===b)return!0}return!1},arrayUnique=function(a){var b,c,d,e,f;c={};for(e=0,f=a.length;e<f;e++)b=a[e],c[b]=!0;return function(){var a;a=[];for(b in c)d=c[b],a.push(b);return a}()},arrayRemove=function(a,b){var c,d,e,f;if(!isArray(a))return[];isArray(b)||(b=[b]);for(d=0,f=b.length;d<f;d++)c=b[d],a=function(){var b,d,f;f=[];for(b=0,d=a.length;b<d;b++)e=a[b],e!==c&&f.push(e);return f}();return a},delay=function(a,b){var c;return isFunction(a)&&(c=[b,a],a=c[0],b=c[1]),isNumber(a)||(a=1),isFunction(b)||(b=function(){}),a<1&&(a=1),setTimeout(b,a)},defer=function(a){return isFunction(a)||(a=function(){}),setTimeout(a,1)},Falcon={version:"0.2.0",applicationElement:"body",baseApiUrl:"",baseTemplateUrl:"",cache:!0,apply:function(a,b,c){var d,e;return isFunction(b)&&(d=[c,b],b=d[0],c=d[1]),isString(b)||(b=""),b=trim(b),isEmpty(b)&&(b=(e=Falcon.applicationElement)!=null?e:"body"),isFunction(c)||(c=function(){return ko.observable()}),document.createElement("template"),$(function(){var d;return $("template").each(function(a,b){var c;return b=$(b),c=b.attr("id"),c!=null&&Falcon.View.cacheTemplate("#"+c,b.html()),b.remove()}),d=$(b),d.attr("data-bind","view: $data"),ko.applyBindings(a,d[0]),c()})},isModel:function(a){return a!=null&&a instanceof Falcon.Model},isCollection:function(a){return a!=null&&a instanceof Falcon.Collection},isView:function(a){return a!=null&&a instanceof Falcon.View},isDataObject:function(a){return a!=null&&(a instanceof Falcon.Model||a instanceof Falcon.Collection)},isFalconObject:function(a){return a!=null&&a instanceof Falcon.Class}},this.Falcon=Falcon,$window=$(window),$document=$(document),Falcon.Class=function(){function a(){this._events={}}return a.prototype["super"]=function(){},a.extend=function(a,b){var c,d,e;return a==null&&(a={}),b==null&&(b={}),e=this,c=null,Object.prototype.hasOwnProperty.call(a,"constructor")?c=a.constructor:c=function(){return e.apply(this,arguments)},d=function(){return this.constructor=c},d.prototype=e.prototype,c.prototype=new d,extend(c.prototype,a),extend(c,e),extend(c,b),c.__super__=e.prototype,c},a.prototype._events=null,a.prototype._super=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],this.__super__[b].apply(this,a)},a.prototype.on=function(a,b,c){var d,e;return!isString(a)||!isFunction(b)?this:(c==null&&(c=this),a=trim(a).toLowerCase(),isEmpty(a)?this:(((e=(d=this._events)[a])!=null?e:d[a]=[]).push({action:b,context:c}),this))},a.prototype.off=function(a,b){var c;return isString(a)?(a=trim(a).toLowerCase(),isEmpty(a)||this._events[a]==null?this:(isFunction(b)?(this._events[a]=function(){var d,e,f,g;f=this._events[a],g=[];for(d=0,e=f.length;d<e;d++)c=f[d],c.action!==b&&g.push(c);return g}.call(this),this._events[a].length<=0&&(this._events[a]=null)):this._events[a]=null,this)):this},a.prototype.has=function(a,b){var c,d,e,f;if(!isString(a))return!1;a=trim(a).toLowerCase();if(isEmpty(a)||this._events[a]==null)return!1;if(this._events[a]!=null&&!isFunction(b))return!0;f=this._events[a];for(d=0,e=f.length;d<e;d++){c=f[d];if(c.action===b)return!0}return!1},a.prototype.relay=function(a,b){var c,d=this;return isString(b)||(c=[b,a],a=c[0],b=c[1]),Falcon.isFalconObject(a)?isEmpty(b)?this:(a.on(b,function(){return d.trigger.apply(d,[b].concat(__slice.call(arguments)))}),this):this},a.prototype.trigger=function(){var a,b,c,d,e,f;b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[];if(!isString(b))return this;b=trim(b).toLowerCase();if(isEmpty(b)||this._events[b]==null)return this;f=this._events[b];for(d=0,e=f.length;d<e;d++)c=f[d],c.action.apply(c.context,a);return this},a}(),Falcon.Model=function(a){function b(a,c){var d,e,f,g;b.__super__.constructor.call(this),a=ko.utils.unwrapObservable(a),c=ko.utils.unwrapObservable(c),c==null&&Falcon.isModel(a)&&(f=[a,c],c=f[0],a=f[1]),Falcon.isModel(a)&&(a=a.unwrap()),this.loading=ko.observable(this.loading),this.parent=c,this.initialize(a),isEmpty(a)||this.fill(a),g=this.fields;for(d in g)e=g[d],this[e]==null&&isString(e)&&(this[e]=null)}return __extends(b,a),b.extend=function(a){return Falcon.Class.extend(Falcon.Model,a)},b.prototype.id=null,b.prototype.url=null,b.prototype.parent=null,b.prototype.fields={},b.prototype.definitions={},b.prototype.loading=!1,b.prototype.initialize=function(a){},b.prototype.get=function(a){return isString(a)?ko.utils.unwrapObservable(this[a]):this.undefined},b.prototype.set=function(a,b){var c,d;if(isObject(a)){for(c in a)d=a[c],this.set(c,d);return this}return isString(a)?(ko.isObservable(this[a])?this[a](b):this[a]=b,this):this},b.prototype.toggle=function(a){return this.set(a,!this.get(a))},b.prototype.fill=function(a){var b,c,d,e,f,g,h;if(isNumber(a)||isString(a))a={id:a};if(!isObject(a))return this;Falcon.isModel(a)&&(a=a.unwrap());if(isEmpty(a))return this;c={};if(isObject(this.fields)&&!isEmpty(this.fields))for(d in a)g=a[d],c[(h=this.fields[d])!=null?h:d]=g;else c=a;e=objectKeys(Falcon.Model.prototype),b=arrayRemove(objectKeys(this),e),f=arrayRemove(e,b),f=arrayRemove(f,"id"),f=arrayUnique(f);for(d in c){g=c[d];if(__indexOf.call(f,d)>=0)continue;g=ko.utils.unwrapObservable(g),Falcon.isModel(this[d])?isEmpty(g)||this[d].fill(g):Falcon.isCollection(this[d])?isEmpty(g)&&this[d].length()<=0||this[d].fill(g):ko.isObservable(this[d])?ko.isWriteableObservable(this[d])&&this[d](g):this[d]=g}return this},b.prototype.unwrap=function(){var a,b,c,d,e,f;c={},b=arrayRemove(objectKeys(this),objectKeys(Falcon.Model.prototype)),b[b.length]="id",b=arrayUnique(b);for(e=0,f=b.length;e<f;e++)a=b[e],d=this[a],c[a]=Falcon.isDataObject(d)?d.unwrap():d;return c},b.prototype.serialize=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;h={},!isBoolean(b)&&isBoolean(a)&&(q=[a,b],b=q[0],a=q[1]),isBoolean(b)||(b=!0),isEmpty(a)&&(a=null),isString(a)&&(a=trim(a).split(",")),a==null&&(a=this.fields),k=[],g=[];if(isArray(a)&&!isEmpty(a))if(isObject(this.fields))for(m=0,o=a.length;m<o;m++)c=a[m],k[k.length]=(r=findKey(this.fields,c))!=null?r:c,g[g.length]=c;else for(n=0,p=a.length;n<p;n++)c=a[n],k[k.length]=c,g[g.length]=c;else if(isObject(a)&&!isEmpty(a))for(i in a)e=a[i],k[k.length]=i,g[g.length]=e in this?e:i;else k=g=arrayRemove(objectKeys(this),objectKeys(Falcon.Model.prototype));k.push("id"),k=arrayUnique(k),g.push("id"),g=arrayUnique(g);for(d in g)f=g[d],j=k[d],l=this[f],Falcon.isDataObject(l)?h[j]=b?l.serialize():l.serialize(["id"]):ko.isObservable(l)?h[j]=ko.utils.unwrapObservable(l):isFunction(l)||(h[j]=l);return h},b.prototype.makeUrl=function(a,b){var c,d,e,f,g,h;h=isFunction(this.url)?this.url():this.url,isString(h)||(h=""),h=trim(h),isString(a)||(a=""),a=a.toUpperCase(),a!=="GET"&&a!=="PUT"&&a!=="POST"&&a!=="DELETE"&&(a="GET"),b=Falcon.isModel(b)?b:this.parent,c="",g=h.lastIndexOf("."),g>-1&&(c=h.slice(g),h=h.slice(0,g)),startsWith(h,"/")||(h="/"+h),Falcon.isModel(b)?(f=b.makeUrl(),d=f.lastIndexOf("."),e=f.lastIndexOf("/"),e<d&&(d>-1&&(f=f.slice(0,d)),f=trim(f)),h=""+f+h):isString(Falcon.baseApiUrl)&&(h=""+Falcon.baseApiUrl+h);if(a==="GET"||a==="PUT"||a==="DELETE")h.slice(-1)!=="/"&&(h+="/"),h+=ko.utils.unwrapObservable(this.id);return""+h+c},b.prototype.remoteFieldsArray=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;b==null&&(b=""),isString(a)&&(a=a.split(",")),isArray(a)||(a=[]),l=[],m={},j={},p={};if(isObject(this.fields)){u=this.fields;for(e in u)o=u[e],p[e]=o}else if(isArray(this.fields)){v=this.fields;for(q=0,s=v.length;q<s;q++)d=v[q],p[d]=d}p["id"]==null&&(p.id="id");for(r=0,t=a.length;r<t;r++)h=a[r],isString(h)&&(h.indexOf(".")>=0?(w=h.split(".",2),i=w[0],f=w[1],n=(x=j[i])!=null?x:findKey(p,i),n!=null&&(j[i]==null&&(j[i]=n),((y=m[n])!=null?y:m[n]=[]).push(f))):(n=findKey(p,h))!=null&&l.push(""+b+n));for(h in j){k=j[h];if(!isFunction(this.definitions[h]))continue;g=this.definitions[h]().prototype,Falcon.isDataObject(g)&&(c=g.remoteFieldsArray(m[k],""+b+k+"."),l=l.concat(c))}return l},b.prototype.sync=function(a,b){var c,d,e,f,g,h,i,j=this;isFunction(b)&&(b={complete:b}),isString(b)&&(b={fields:trim(b).split(",")}),isArray(b)&&(b={fields:b}),isObject(b)||(b={}),isObject(b.data)||(b.data={}),isString(b.dataType)||(b.dataType="json"),isString(b.contentType)||(b.contentType="application/json"),isFunction(b.success)||(b.success=function(){}),isFunction(b.complete)||(b.complete=function(){}),isFunction(b.error)||(b.error=function(){}),Falcon.isModel(b.parent)||(b.parent=this.parent),isObject(b.fields)&&(b.fields=flattenObjectKeys(b.fields)),isArray(b.fields)||(b.fields=[]),isObject(b.params)||(b.params={}),isBoolean(b.fill)||(b.fill=!0),isObject(b.headers)||(b.headers={}),a=trim(isString(a)?a.toUpperCase():"GET"),a!=="GET"&&a!=="POST"&&a!=="PUT"&&a!=="DELETE"&&(a="GET"),c={};if(!isEmpty(b.data)){h=b.data;for(e in h)g=h[e],c[e]=g}if(a==="POST"||a==="PUT")c=extend(this.serialize(b.fields),c);return d=isEmpty(c)?"":JSON.stringify(c),f=(i=b.url)!=null?i:this.makeUrl(a,b.parent),b.fields.length>0&&b.params["fields"]==null&&(b.params.fields=b.fields),isArray(b.params.fields)&&(b.params.fields=trim(b.params.fields.join(","))),isEmpty(b.params)||(f.indexOf("?")>-1||(f+="?"),f+=function(){var a,c;a=b.params,c=[];for(e in a)g=a[e],c.push(""+e+"="+g);return c}().join("&")),this.loading(!0),$.ajax({url:f,type:a,data:d,dataType:b.dataType,contentType:b.contentType,cache:Falcon.cache,headers:b.headers,beforeSend:function(a){return a.withCredentials=!0},success:function(c,d,e){var f;b.fill&&j.fill(c);switch(a){case"GET":j.trigger("fetch",c);break;case"POST":j.trigger("create",c);break;case"PUT":j.trigger("save",c);break;case"DELETE":j.trigger("destroy",c)}return(f=b.success).call.apply(f,[j,j].concat(__slice.call(arguments)))},error:function(a){var c;c=a.responseText;try{isString(c)&&(c=JSON.parse(c))}catch(d){}return b.error.call(j,j,c,a)},complete:function(a){var c;return j.loading(!1),(c=b.complete).call.apply(c,[j,j].concat(__slice.call(arguments)))}}),this},b.prototype.fetch=function(a){return this.sync("GET",a)},b.prototype.create=function(a){return this.sync("POST",a)},b.prototype.save=function(a){return this.sync("PUT",a)},b.prototype.destroy=function(a){return this.sync("DELETE",a)},b.prototype.equals=function(a){return a=ko.utils.unwrapObservable(a),Falcon.isModel(a)?a.get("id")===this.get("id"):isNumber(a)?a===this.get("id"):!1},b.prototype.mixin=function(a){var b,c,d=this;isObject(a)||(a={});for(b in a)c=a[b],Falcon.isDataObject(this[b])?this[b].mixin(c):ko.isObservable(c)?this[b]=ko.observable(ko.utils.unwrapObservable(c)):isFunction(c)?function(){var a;return a=c,d[b]=function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],a.call.apply(a,[d,d].concat(__slice.call(b)))}}():this[b]=c;return this},b.prototype.clone=function(a){return a=a!=null||a===null?a:this.parent,new this.constructor(this.unwrap(),a)},b.prototype.copy=function(a){var b;return isArray(a)||(a=["id","parent"]),b=new this.constructor,b.fill(this.serialize(a)),arrayContains(a,"parent")&&(b.parent=this.parent),b},b.prototype.isNew=function(){return this.get("id")==null},b}(Falcon.Class),Falcon.View=function(a){function c(){var a,d,e=this;c.__super__.constructor.call(this),a=this.makeUrl(),this.is_loaded=ko.observable(!1),this.is_destroyed=!1,this._child_views=[],d=function(){return e._loaded_url=a,e.is_loaded(!0),e.trigger("load")},this.initialize.apply(this,arguments),isEmpty(a)||a in b?d():startsWith(a,"#")?(b[a]=$(a).html(),d()):$.ajax({url:a,type:"GET",cache:!1,error:function(){return console.log("ERROR LOADING TEMPLATE "+a),e.trigger("error")},success:function(c){return b[a]=c,d()}})}var b;return __extends(c,a),b={},c.cacheTemplate=function(a,c){isString(a)||(a=""),isString(c)||(c=""),a=trim(a),b[a]=c},c.prototype.url=null,c.prototype._loaded_url=null,c.prototype.is_loaded=!1,c.prototype.is_destroyed=!1,c.prototype.makeUrl=function(){var a,b;return a=ko.utils.unwrapObservable(this.url),isFunction(a)&&(a=a()),isString(a)||(a=""),a=trim(a),(b=a.slice(0,1))!=="/"&&b!=="#"&&(a="/"+a),isString(Falcon.baseTemplateUrl)&&startsWith(a,"/")&&(a=""+Falcon.baseTemplateUrl+a),a},c.prototype.template=function(){var a;return ko.utils.unwrapObservable(this.is_loaded)?(a=b[this._loaded_url])!=null?a:"":""},c.prototype.destroy=function(){var a,b,c,d;if(this.is_destroyed)return;d=this._child_views;for(b=0,c=d.length;b<c;b++)a=d[b],a.destroy();this.dispose.apply(this,arguments),this._child_views=null,this.is_destroyed=!0},c.prototype.initialize=function(){},c.prototype.dispose=function(){},c.prototype._addChildView=function(a){if(!Falcon.isView(a))return;return this._child_views.push(a)},c.prototype.viewModel=function(){var a,b,c,d=this;c={__falcon_addChildView__:function(a){return d._addChildView(a)}};for(a in this){b=this[a];if(a in Falcon.View.prototype)continue;isFunction(b)&&!ko.isObservable(b)&&(b=function(){var a;return a=b,function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],a.call.apply(a,[d].concat(__slice.call(b)))}}()),c[a]=b}return c},c}(Falcon.Class),Falcon.Collection=function(a){function c(a,b){var d,e=this;c.__super__.constructor.call(this),a=ko.utils.unwrapObservable(a),b=ko.utils.unwrapObservable(b),b==null&&Falcon.isModel(a)&&(d=[a,b],b=d[0],a=d[1]),this.model!=null&&this.url==null&&(this.url=this.model.prototype.url),this.parent=b,this.length=ko.observable(ko.utils.unwrapObservable(this.length)),this.loading=ko.observable(ko.utils.unwrapObservable(this.loading)),this.populated=ko.computed(function(){return e.length()>0}),this._mappings=[],this.reset(),isEmpty(a)||this.fill(a),this.initialize(a)}var b;return __extends(c,a),c.prototype._mappings=null,c.extend=function(a){return Falcon.Class.extend(Falcon.Collection,a)},c.prototype.models=null,c.prototype.model=null,c.prototype.__change_count__=0,c.prototype.url=null,c.prototype.length=0,c.prototype.parent=null,c.prototype.loading=!1,c.prototype.initialize=function(){},c.prototype.fill=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(this.model==null)return this;a==null&&(a=[]),Falcon.isCollection(a)&&(a=a.models()),ko.isObservable(a)&&(a=ko.utils.unwrapObservable(a)),isArray(a)||(a=[a]),j=[],c==null&&(c={}),isObject(c)||(c={}),h=c.method,isString(h)||(h=""),h=h.toLowerCase(),h!=="replace"&&h!=="append"&&h!=="prepend"&&h!=="merge"&&(h="replace");if(h!=="replace"&&isEmpty(a))return[];this.__change_count__++;for(d=0,o=a.length;d<o;d++){f=a[d],j[d]=new this.model({},this.parent),x=this._mappings;for(k=0,p=x.length;k<p;k++)g=x[k],j[d].mixin(g);Falcon.isModel(f)&&(f=f.serialize()),isEmpty(f)||j[d].fill(f)}if(h==="replace")this.models(j);else if(h==="merge"){w=this.models();for(l=0,q=j.length;l<q;l++){i=j[l],e=b(i),v=null;for(m=0,r=w.length;m<r;m++){f=w[m];if(!e(f))continue;v=f;break}v?v.fill(i):this.models.push(i)}}else if(h==="prepend"){u=j.length-1;for(d=0,s=j.length;d<s;d++)i=j[d],this.models.unshift(j[u-d])}else if(h==="append")for(n=0,t=j.length;n<t;n++)i=j[n],this.models.push(i);return this.length(this.models().length),j},c.prototype.unwrap=function(){var a,b,c,d;b=[],d=this.models();for(a in d)c=d[a],b[a]=Falcon.isDataObject(c)?c.unwrap():c;return b},c.prototype.serialize=function(a,b){var c,d,e,f;d=[],f=this.models();for(c in f)e=f[c],d[c]=Falcon.isDataObject(e)?e.serialize(a,b):e;return d},c.prototype.makeUrl=function(a){var b,c,d,e;return e=isFunction(this.url)?this.url():this.url,isString(e)||(e=""),e=trim(e),isString(a)||(a=""),a=a.toUpperCase(),a!=="GET"&&a!=="PUT"&&a!=="POST"&&a!=="DELETE"&&(a="GET"),startsWith(e,"/")||(e="/"+e),Falcon.isModel(this.parent)?(d=this.parent.makeUrl(),b=d.lastIndexOf("."),c=d.lastIndexOf("/"),c<b&&(b>-1&&(d=d.slice(0,b)),d=trim(d)),e=""+d+e):isString(Falcon.baseApiUrl)&&(e=""+Falcon.baseApiUrl+e),e},c.prototype.fetch=function(a){return this.sync("GET",a)},c.prototype.remoteFieldsArray=function(a,b){return this.model.prototype.remoteFieldsArray(a,b)},c.prototype.sync=function(a,b){var c,d,e,f,g,h,i,j=this;isFunction(b)&&(b={success:b}),isObject(b)||(b={}),isObject(b.data)||(b.data={}),isString(b.dataType)||(b.dataType="json"),isString(b.contentType)||(b.contentType="application/json"),isFunction(b.success)||(b.success=function(){}),isFunction(b.complete)||(b.complete=function(){}),isFunction(b.error)||(b.error=function(){}),isObject(b.fields)&&(b.fields=flattenObjectKeys(b.fields)),isArray(b.fields)||(b.fields=[]),isObject(b.params)||(b.params={}),isBoolean(b.fill)||(b.fill=!0),isObject(b.headers)||(b.headers={}),a=isString(a)?a.toUpperCase():"GET",a!=="GET"&&a!=="POST"&&a!=="PUT"&&a!=="DELETE"&&(a="GET"),a=trim(a),c={};if(!isEmpty(b.data)){h=b.data;for(d in h)g=h[d],c[d]=g}f=(i=b.url)!=null?i:trim(this.makeUrl(a));if(f==null||!isString(f))return;return b.params["fields"]!=null&&b.fields.length>0||(e=this.remoteFieldsArray(b.fields),e.length<=0||(b.params.fields=e)),isArray(b.params.fields)&&(b.params.fields=trim(b.params.fields.join(","))),isEmpty(b.params)||(f.indexOf("?")>-1||(f+="?"),f+=function(){var a,c;a=b.params,c=[];for(d in a)g=a[d],c.push(""+d+"="+g);return c}().join("&")),this.loading(!0),$.ajax({url:f,type:a,data:c,dataType:b.dataType,contentType:b.contentType,cache:Falcon.cache,headers:b.headers,success:function(c,d,e){var f;return c==null&&(c=[]),isString(c)&&(c=JSON.parse(c)),isEmpty(c)&&(c=JSON.parse(e.responseText)),b.fill&&a==="GET"&&j.fill(c,b),(f=b.success).call.apply(f,[j,j].concat(__slice.call(arguments)))},error:function(a){var c;c=a.responseText;try{isString(c)&&(c=JSON.parse(c))}catch(d){}return b.error.call(j,j,c,a)},complete:function(){var a;return j.loading(!1),(a=b.complete).call.apply(a,[j,j].concat(__slice.call(arguments)))}})},c.prototype.remove=function(a){var b;return a=ko.utils.unwrapObservable(a),Falcon.isCollection(a)&&(a=a.models()),this.__change_count__++,b=isArray(a)?this.models.removeAll(a):this.models.remove(a),isEmpty(b)||this.length(this.models().length),this},c.prototype.append=function(a){return this.fill(a,{method:"append"})},c.prototype.prepend=function(a){return this.fill(a,{method:"prepend"})},c.prototype.unshift=function(){return this.prepend.apply(this,arguments)},c.prototype.shift=function(){var a;return a=this.models.shift(),this.length(this.models().length),a},c.prototype.push=function(){return this.append.apply(this,arguments)},c.prototype.pop=function(){var a;return a=this.models.pop(),this.length(this.models().length),a},c.prototype.sort=function(a){var b;b=this.models();if(!isArray(b))return;return isFunction(a)?b.sort(a):b},c.prototype.create=function(a,b){var c,d=this;if(this.model==null)return;return Falcon.isModel(a)&&(a=a.unwrap()),isObject(a)||(a={}),isFunction(b)&&(b={success:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),isString(b.method)||(b.method="append"),c=b.success,b.success=function(a){var e;return e=d.fill(a,b),e.length===1&&(arguments[0]=e=e[0]),c.apply(e,arguments)},(new this.model(a,this.parent)).create(b)},c.prototype.destroy=function(a,b){var c,d,e,f,g=this;if(this.model==null)return this;a=ko.utils.unwrapObservable(a);if(a==null||a==="all")a=this.models();Falcon.isCollection(a)&&(a=a.models()),isArray(a)||(a=[a]);if(isEmpty(a))return this;isFunction(b)&&(b={success:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),b.parent=this.parent,f=b.success,b.success=function(a){return g.remove(a),f.apply(a,arguments)};for(d=0,e=a.length;d<e;d++)c=a[d],Falcon.isDataObject(c)&&c.destroy(b);return this},c.prototype.at=function(a){var b;return isNumber(a)||(a=0),a=parseInt(a),b=this.models(),a<0&&(a=0),a>=b.length&&(a=b.length-1),b[a]},c.prototype.each=function(a,b){var c,d,e,f,g,h,i;if(!isFunction(a))return this;b==null&&(b=this);if(a.length===1){h=this.models();for(e=0,f=h.length;e<f;e++)d=h[e],a.call(b,d)}else{i=this.models();for(d=0,g=i.length;d<g;d++)c=i[d],a.call(b,c,d)}return this},b=function(a){var b,c;return Falcon.isModel(a)?(c=a,function(a){var b,d;return Falcon.isModel(a)?(b=a.get("id"),d=c.get("id"),b===d):!1}):isNumber(a)||isString(a)?(b=a,function(a){return Falcon.isModel(a)?a.get("id")===b:!1}):a},c.prototype.first=function(a){var c,d,e,f;a=b(a),isFunction(a)||(a=function(){return!0}),f=this.models();for(d=0,e=f.length;d<e;d++){c=f[d];if(a(c))return c}return null},c.prototype.last=function(a){var c,d,e;a=b(a),isFunction(a)||(a=function(){return!0}),e=this.models();for(c in e){d=e[c],d=e[e.length-c-1];if(a(d))return d}return null},c.prototype.slice=function(a,b){return this.models.slice(a,b)},c.prototype.all=function(a){var c;return a=b(a),function(){var b,d,e,f;e=this.models(),f=[];for(b=0,d=e.length;b<d;b++)c=e[b],a(c)&&f.push(c);return f}.call(this)},c.prototype.any=function(a){var c,d,e,f;a=b(a);if(!isFunction(a))return!1;f=this.models();for(d=0,e=f.length;d<e;d++){c=f[d];if(a(c))return!0}return!1},c.prototype.without=function(a){var c;return a=b(a),isFunction(a)?function(){var b,d,e,f;e=this.models(),f=[];for(b=0,d=e.length;b<d;b++)c=e[b],a(c)||f.push(c);return f}.call(this):this.models()},c.prototype.mixin=function(a){var b,c,d,e,f,g,h,i=this;isObject(a)||(a={}),g={};for(b in a)d=a[b],ko.isObservable(d)?g[b]=ko.observable(ko.utils.unwrapObservable(d)):isFunction(d)?function(){var a;return a=d,g[b]=function(){return a.call(arguments[0],arguments[0],i)}}():g[b]=d;h=this.models();for(e=0,f=h.length;e<f;e++)c=h[e],Falcon.isDataObject(c)&&c.mixin(g);return this._mappings.push(g),this},c.prototype.pluck=function(a,b){var c,d,e,f,g,h,i,j,k;isString(a)&&(a=a.split(",")),isArray(a)||(a=[]);if(a.length>0){b==null&&(b=!0),e=[];if(a.length>1){j=this.models();for(f=0,h=j.length;f<h;f++)d=j[f],isObject(d)?e.push(function(){var e,f,g;g=[];for(e=0,f=a.length;e<f;e++)c=a[e],g.push(b?ko.utils.unwrapObservable(d[c]):d[c]);return g}()):e.push(window.undefined)}else if(a.length===1){c=a[0],k=this.models();for(g=0,i=k.length;g<i;g++)d=k[g],isObject(d)?e.push(b?ko.utils.unwrapObservable(d[c]):d[c]):e.push(window.undefined)}return e}return[]},c.prototype.clone=function(a){return a=a===null||Falcon.isModel(a)?a:this.parent,new this.constructor(this.unwrap(),a)},c.prototype.copy=function(a){var b;return isArray(a)||(a=["id","parent"]),b=new this.constructor,b.fill(this.serialize(a)),arrayContains(a,"parent")&&(b.parent=this.parent),b},c.prototype.reset=function(){return this.__change_count__+=1,this.models==null&&(this.models=ko.observableArray([])),this.models.extend({throttle:1}),this.models([]),this.length(0),this},c}(Falcon.Class),Falcon.Report=function(a){function c(a,d){var e;c.__super__.constructor.call(this),isArray(a)&&(e=[d,a],a=e[0],d=e[1]),this.url==null&&(this.url=a!=null?a:""),this.columns==null&&(this.columns=d!=null?d:[]),this.data=ko.observableArray([]),this.loading=ko.observable(!1),this._parameters={},this._formatting={},this._current_request=null,this.haxis=new b,this.vaxis=new b}var b;return __extends(c,a),b=function(){function a(){this.title="",this.format=""}return a.prototype.options=function(){return{title:this.title,format:this.format}},a}(),c.prototype.columns=null,c.prototype.url=null,c.prototype._formatting=null,c.prototype.haxis=null,c.prototype.vaxis=null,c.prototype.data=null,c.prototype._parameters=null,c.prototype.response_handler=function(){},c.prototype.param=function(a,b){return this._parameters[a]=b,this},c.prototype.fetch=function(a){var b,c,d,e,f,g,h,i=this;e=isFunction(this.url)?this.url():this.url,isString(e)||(e="");if(!isString(e))return;isFunction(a)||(a=function(){}),this.loading(!0),d={},g=this._parameters;for(c in g)h=g[c],f=ko.utils.unwrapObservable(h),Falcon.isModel(f)?d[c]=f.get("id"):isFunction(f)?d[c]=f():d[c]=f;e+="/",b=!1;for(c in d)f=d[c],e=e.replace(":"+c+"/",""+f+"/"),b=b||f==null;e=e.slice(0,-1);if(b)return;return e=Falcon.baseApiUrl+e,this._current_request=$.ajax({type:"GET",url:e,data:d,success:function(b){return b==null&&(b=[]),isArray(b)||(b=[b]),i.data(b),i.trigger("success",b),a.apply(i,arguments)},error:function(a){return i.trigger("error",a)},complete:function(){return i._current_request=null,i.loading(!1)}})},c.prototype.request=function(a){var b=this;if(a==null)return;return this.fetch(function(){var c;return c={hAxis:b.haxis.options(),vAxis:b.vaxis.options()},a.draw(b.dataTable(),c)})},c.prototype.format=function(a,b,c){var d;_.isString(a)||(a=""),_.isString(b)||(b=""),a=_.trim(a),b=_.trim(b).toLowerCase();if(_.isEmpty(a))return;if(_.isEmpty(b))return;return d=function(){},b==="number"&&(d=function(){return new google.visualization.NumberFormat(c)}),this._formatting[a]={type:b,formatter:d}},c.prototype.parseColumn=function(a){var b;return _.isString(b)||(b=""),a.split(" ",3)},c.prototype.parseItem=function(a,b){var c,d;b=ko.utils.unwrapObservable(b),c=this._formatting[a];if(c!=null){d=c.type;if(d==="number")return parseFloat(b)}return b},c.prototype.dataTable=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;g=new google.visualization.DataTable,e=[],l=this.columns;for(b=0,j=l.length;b<j;b++)a=l[b],m=this.parseColumn(a),h=m[0],d=m[1],f=m[2],e.push(d),g.addColumn(h,f),this._formatting[d]!=null&&this._formatting[d].formatter().format(g,b);n=this.data();for(i=0,k=n.length;i<k;i++)c=n[i],isObject(c)&&g.addRow(function(){var a,b,f;f=[];for(a=0,b=e.length;a<b;a++)d=e[a],f.push(this.parseItem(d,c[d]));return f}.call(this));return g},c}(Falcon.Class),Falcon.Event=function(){function a(a){if(a==null)throw new Error("Element must be given");this._element=$(a)}return a.UP_KEY=38,a.DOWN_KEY=40,a.RIGHT_KEY=39,a.LEFT_KEY=37,a.ENTER_KEY=13,a.prototype._element=null,a.prototype.on=function(a,b){var c,d;isString(a)||(a=""),c=this._element,isFunction(b)||(b=function(){}),a=trim(a);if(isEmpty(a))return;return d=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],c.parents("body").length>0?b.call.apply(b,[this].concat(__slice.call(e))):$window.off(a,d)},$window.on(a,d)},a}(),ko.bindingHandlers.view=function(){var getTemplate,getViewModel,makeTemplateValueAccessor,returnVal;return makeTemplateValueAccessor=function(a){return function(){return{data:a,templateEngine:ko.nativeTemplateEngine.instance}}},getViewModel=function(a){var b,c;return b={},a==null&&(a={}),a instanceof Falcon.View?b=a.viewModel():b=ko.utils.unwrapObservable((c=a.viewModel)!=null?c:{}),b},getTemplate=function(a){var b,c;return b="",a==null&&(a={}),a instanceof Falcon.View?b=a.template():b=ko.utils.unwrapObservable((c=a.template)!=null?c:""),b},returnVal={controlsDescendantBindings:!0},{init:function(a,b,c,d,e){var f,g,h;return h=b(),h!=null&&ko.isSubscribable(h)?(f=ko.utils.unwrapObservable(h),g=h.subscribe(function(a){return Falcon.isView(f)&&f.destroy(),f=a}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){return Falcon.isView(f)&&f.destroy(),g.dispose()})):Falcon.isView(h)&&ko.utils.domNodeDisposal.addDisposeCallback(a,function(){return h.destroy()}),h=ko.utils.unwrapObservable(h),d=getViewModel(h),ko.bindingHandlers.template.init(a,makeTemplateValueAccessor(d),c,d,e),returnVal},update:function(element,valueAccessor,allBindingsAccessor,viewModel,context){var anonymousTemplate,execScripts,originalViewContext,template,value,_ref;value=valueAccessor(),value=ko.utils.unwrapObservable(value),viewModel=getViewModel(value),template=getTemplate(value);if(!isObject(value))return returnVal;originalViewContext=context.$view,context.$view=viewModel,Falcon.isView(originalViewContext)&&originalViewContent.__falcon_addChildView__(value);if(isEmpty(viewModel)||template==null)$(element).empty();else if(!(value instanceof Falcon.View)||value.is_loaded())anonymousTemplate=ko.utils.domData.get(element,"__ko_anon_template__"),((_ref=anonymousTemplate.containerData)!=null?_ref.innerHTML:void 0)!=null?anonymousTemplate.containerData.innerHTML=template:anonymousTemplate.textData=template,ko.bindingHandlers.template.update(element,makeTemplateValueAccessor(viewModel),allBindingsAccessor,viewModel,context),execScripts=!!ko.utils.unwrapObservable(value.execScripts),template!==anonymousTemplate&&execScripts===!0&&$(element).find("script").each(function(index,script){script=$(script);if(script.attr("type").toLowerCase()==="text/javascript")return eval(script.text())});return Falcon.isView(value)&&value.trigger("render"),context.$view=originalViewContext,returnVal}}}(),_getItems=function(a){var b;return b=ko.utils.unwrapObservable(Falcon.isCollection(a)?a.models():a),isArray(b)||(b=[b]),function(){return b}},_shouldUpdate=function(a,b){var c,d;return Falcon.isCollection(b)?(c=b.__change_count__,d=ko.utils.domData.get(a,"__falcon_collection___change_count__"),d===c?!1:(ko.utils.domData.set(a,"__falcon_collection___change_count__",c),!0)):!0},_foreach=(_ref=ko.bindingHandlers["foreach"])!=null?_ref:function(){},ko.bindingHandlers.foreach={init:function(){var a,b,c,d,e;return b=arguments[0],d=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],c=ko.utils.unwrapObservable(d()),ko.utils.domData.set(b,"__falcon_collection___change_count__",-1),((e=_foreach["init"])!=null?e:function(){}).apply(null,[b,_getItems(c)].concat(__slice.call(a)))},update:function(){var a,b,c,d,e;b=arguments[0],d=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],c=ko.utils.unwrapObservable(d());if(_shouldUpdate(b,c))return((e=_foreach["update"])!=null?e:function(){}).apply(null,[b,_getItems(c)].concat(__slice.call(a)));Falcon.isCollection(c)&&c.trigger("render")}};for(key in _foreach)value=_foreach[key],key in ko.bindingHandlers.foreach||(ko.bindingHandlers.foreach[key]=value);_options=(_ref2=ko.bindingHandlers["options"])!=null?_ref2:function(){},ko.bindingHandlers.options=function(){return{init:function(){var a,b,c,d;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],value=ko.utils.unwrapObservable(c()),ko.utils.domData.set(b,"__falcon_collection___change_count__",-1),((d=_options["init"])!=null?d:function(){}).apply(null,[b,_getItems(value)].concat(__slice.call(a)))},update:function(){var a,b,c,d;b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],value=ko.utils.unwrapObservable(c());if(_shouldUpdate(b,value))return((d=_options["update"])!=null?d:function(){}).apply(null,[b,_getItems(value)].concat(__slice.call(a)));Falcon.isCollection(value)&&value.trigger("render")}}}(),ko.bindingHandlers.log={update:function(a,b){return console.log(ko.utils.unwrapObservable(b()))}},_bindingContext=ko.bindingContext,ko.bindingContext=function(a,b){return this["$view"]==null&&b!=null&&(this.$view=b.$view||b.$root),_bindingContext.call(this,a,b)},ko.bindingContext.prototype=_bindingContext.prototype,ko.virtualElements.allowedBindings.view=!0,ko.virtualElements.allowedBindings.log=!0,ko.virtualElements.allowedBindings.collection=!0,ko.subscribable.fn.classify=function(){var a,b,c,d,e;c=1<=arguments.length?__slice.call(arguments,0):[],a={};for(d=0,e=c.length;d<e;d++){b=c[d];if(!isString(b)||!!isEmpty(trim(b)))continue;b=trim(b),a[b]=!0}return this.extend(a)}})).call(this)