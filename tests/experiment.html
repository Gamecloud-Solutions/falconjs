<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Falcon.JS | Experimentation</title>

  <script type="text/javascript" src="lib/knockout-3.1.0.min.js"></script>

  <!-- include source files here... -->
  <script type="text/javascript" src="scripts/falcon.min.js"></script>

  <script>
    var ContentView = Falcon.View.extend({
      url: "#content",

      title: "content",

      observables: {
        child_view: null
      },

      addContentView: function() {
        this.child_view( new ContentView );
      },

      addFinalView: function() {
        this.child_view( new FinalView );
      },

      display: function() { console.log("Display Content View"); },
      dispose: function() { console.log("Disposed Content View"); }
    });
   
    var FinalView = ContentView.extend({
      title: "final",
      display: function() { console.log("Display Final View"); },
      dispose: function() { console.log("Disposed Final View"); }
    });
    
    var LayoutView = Falcon.View.extend({
      url: "#layout",

      defaults: {
        content_view: function() { return new ContentView }
      },

      observables: {
        should_display: true
      },

      toggleDisplay: function()
      {
        this.should_display( !this.should_display() );
      },

      beforeDispose: function(nodes, continuation) {
        console.log("beforeDispose", nodes);
        window.next = continuation;
      },

      afterDisplay: function(nodes) {
        console.log("afterDisplay", nodes)
      },

      continuation: function(){},
      triggerNext: function() {
        if(window.next) window.next();
        window.next = null;
      }
    });

    Falcon.apply(new LayoutView);
  </script>

</head>
  <body>
  </body>
  <template id="layout">
    <button data-bind="click: $view.toggleDisplay">Toggle</button>
    <button data-bind="click: $view.triggerNext">Next</button>
    <hr />
    <!-- ko view: {data: $view.content_view, displayIf: $view.should_display, beforeDispose: $view.beforeDispose, afterDisplay: $view.afterDisplay} --><!-- /ko -->
    <hr />
  </template>
  <template id="content">
    <div>This is <!-- ko text: $view.title --><!-- /ko --></div>
    <!-- ko if: $view.child_view -->
      <!-- ko view: $view.child_view --><!-- /ko -->
    <!-- /ko -->
    <!-- ko ifnot: $view.child_view -->
      <button data-bind="click: $view.addContentView">Content View</button>
      <button data-bind="click: $view.addFinalView">Final View</button>
    <!-- /ko -->
  </template>
</html>
