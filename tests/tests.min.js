((function(){var Falcon,arrayContains,arrayPeek,arraysEqual,compact,countSubstrings,defer,delay,endsWith,extend,isArray,isBoolean,isEmpty,isFunction,isNumber,isObject,isString,objectKeys,objectValues,objectsEqual,startsWith,trim,trimSlashes,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__slice=Array.prototype.slice;isObject=function(a){return typeof a==typeof {}&&a!==null},isFunction=function(a){return Object.prototype.toString.call(a)==="[object Function]"},isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"},isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},isString=function(a){return Object.prototype.toString.call(a)==="[object String]"},isNumber=function(a){return Object.prototype.toString.call(a)==="[object Number]"},isEmpty=function(a){var b,c;if(isObject(a)){for(b in a)return c=a[b],!1;return!0}return isString(a||isArray(a))?a.length===0:a===null||typeof a=="undefined"?!0:!1},trim=function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},trimSlashes=function(a){return a.replace(/^\//,"").replace(/\/$/,"")},startsWith=function(a,b){return a.indexOf(b)===0},endsWith=function(a,b){return a.indexOf(b,a.length-b.length)!==-1},countSubstrings=function(a,b){return a.split(b).length-1},objectKeys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},objectValues=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(c);return d},objectsEqual=function(a,b){var c,d;for(c in a){d=a[c];if(b[c]!==d)return!1}for(c in b){d=b[c];if(a[c]!==d)return!1}return!0},compact=function(a){var b,c,d;isObject(a)||(a={}),c={};for(b in a)d=a[b],d!=null&&(c[b]=d);return c},extend=function(a,b){var c,d;a==null&&(a={}),isObject(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},arraysEqual=function(a,b){var c,d,e;if(a.length!==b.length)return!1;for(c=0,e=a.length;c<e;c++){d=a[c];if(b[c]!==d)return!1}return!0},arrayPeek=function(a){return a[a.length-1]},arrayContains=function(a,b){var c,d,e;if(isFunction(a.indexOf))return a.indexOf(b)!==-1;if(isArray(a))for(d=0,e=a.length;d<e;d++){c=a[d];if(c===b)return!0}return!1},delay=function(a,b){var c;return isFunction(a)&&(c=[b,a],a=c[0],b=c[1]),isNumber(a)||(a=1),isFunction(b)||(b=function(){}),a<1&&(a=1),setTimeout(b,a)},defer=function(a){return isFunction(a)||(a=function(){}),setTimeout(a,1)},Falcon={version:"0.0.1",apply:function(a){return $(function(){return $("body").attr("data-bind","view: $data"),ko.applyBindings(a)})},isModel:function(a){return a!=null&&a instanceof Falcon.Model},isCollection:function(a){return a!=null&&a instanceof Falcon.Collection},isView:function(a){return a!=null&&a instanceof Falcon.View},isDataObject:function(a){return a!=null&&(a instanceof Falcon.Model||a instanceof Falcon.Collection)}},this.Falcon=Falcon,Falcon.Class=function(){function a(){}return a.prototype["super"]=function(){},a.extend=function(a,b){var c,d;return a==null&&(a=Falcon.Class),c=null,b!=null&&b.hasOwnProperty("constructor")?c=b.constructor:c=function(){return this.__super__.apply(this,arguments)},d=function(){},d.prototype=a.prototype,c.prototype=new d,c.prototype.__super__=function(){return a.apply(this,arguments)},c.extend=function(a){return Falcon.Class.extend(c,a)},extend(c.prototype,b!=null?b:{}),c},a}(),Falcon.Model=function(a){function b(a,b){var c;Falcon.isModel(a)&&(c=[a,b],b=c[0],a=c[1]),this._events={},this.id=ko.observable(0),this.parent=b,this.initialize(a),this.data(a)}return __extends(b,a),b.extend=function(a){return Falcon.Class.extend(Falcon.Model,a)},b.prototype.url=null,b.prototype.parent=null,b.prototype._events=null,b.prototype.initialize=function(){},b.prototype.data=function(a){var b,c,d,e;if(isEmpty(a)){c={};for(b in this){d=this[b];if(!(b in Falcon.Model.prototype))if(d instanceof Falcon.Model||d instanceof Falcon.Collection)c[b]=d.data();else if(ko.isObservable(d)||isFunction(d))c[b]=d}return c}isObject(a)||(a={}),e=[];for(b in a)d=a[b],e.push(this.set(b,d));return e},b.prototype.get=function(a){var b;if(!isString(a))return;return b=this[a],ko.utils.unwrapObservable(b)},b.prototype.set=function(a,b){var c,d;return a==null||a in Falcon.Model.prototype?this:(ko.isObservable(b)&&(b=ko.utils.unwrapObservable(b)),c=(d=this[a])!=null?d:this[a]=ko.observable(),c instanceof Falcon.Model||c instanceof Falcon.Collection?c.data(b):ko.isObservable(c)&&c(b),this)},b.prototype.makeUrl=function(a){var b,c,d;d=trim(isFunction(this.url)?this.url():this.url),b="",c=d.lastIndexOf("."),c>-1&&(b=d.slice(c),d=d.slice(0,c));if(a==="GET"||a==="PUT"||a==="DELETE")d.slice(-1)!=="/"&&(d+="/"),d+=this.id();return""+d+b},b.prototype.sync=function(a,b){var c,d=this;return isFunction(b)&&(b={complete:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),isFunction(b.error)||(b.error=function(){}),isFunction(b.complete)||(b.complete=function(){}),a=isString(a)?a.toUpperCase():"GET",a!=="GET"&&a!=="POST"&&a!=="PUT"&&a!=="DELETE"&&(a="GET"),a=trim(a),c=this.makeUrl(a),$.ajax({url:c,type:a,data:this.toJSON(),error:function(){var a;return(a=b.error).call.apply(a,[d,d].concat(__slice.call(arguments)))},success:function(c){var e;d.data(c);switch(a){case"GET":d.trigger("fetch");break;case"POST":d.trigger("create");break;case"PUT":d.trigger("save");break;case"DELETE":d.trigger("destroy")}return(e=b.success).call.apply(e,[d,d].concat(__slice.call(arguments)))},complete:function(){var a;return(a=b.complete).call.apply(a,[d,d].concat(__slice.call(arguments)))}}),this},b.prototype.map=function(a){var b,c,d=this;isObject(a)||(a={});for(b in a)c=a[b],Falcon.isDataObject(this[b])?this[b].map(c):(ko.isObservable(c)?c=ko.observable(ko.utils.unwrapObservable(c)):isFunction(c)&&(c=function(){var a;return a=c,function(){return a.call(d,d)}}()),this[b]=c);return this},b.prototype.on=function(a,b){var c,d,e=this;return a==null||b==null?this:(isString(a)||(a=""),isFunction(b)||(b=function(){}),a=trim(a).toLowerCase(),isEmpty(a)?this:(((d=(c=this._events)[a])!=null?d:c[a]=[]).push(function(){return b.call(e,e)}),this))},b.prototype.trigger=function(a){var b,c,d,e;if(a==null)return this;isString(a)||(a=""),a=trim(a).toLowerCase();if(isEmpty(a)||this._events[a]==null)return this;e=this._events[a];for(c=0,d=e.length;c<d;c++)b=e[c],b();return this},b.prototype.fetch=function(a){return this.sync("GET",a)},b.prototype.create=function(a){return this.sync("POST",a)},b.prototype.save=function(a){return this.sync("PUT",a)},b.prototype.destroy=function(a){return this.sync("DELETE",a)},b.prototype.toJSON=function(){var a,b,c,d,e,f;a={},f=this.data();for(b in f)e=f[b],a[b]=e;d=(c=function(a){var b,d,e;a=ko.utils.unwrapObservable(a);if(isArray(a))return function(){var b,d,f;f=[];for(b=0,d=a.length;b<d;b++)e=a[b],f.push(c(e));return f}();if(isObject(a)){d={};for(b in a)e=a[b],d[b]=c(e);return d}return a})(a);if(!isEmpty(d))return ko.utils.stringifyJson(d)},b}(Falcon.Class),Falcon.View=function(a){function c(){var a=this;this.template=ko.observable(ko.utils.unwrapObservable(this.template)),isString(this.url)||(this.url=""),this.url=trim(this.url),this._loaded=!1,isEmpty(this.url)?this._loaded=!0:this.url in b?(this._loaded=!0,this.template(b[this.url])):$.ajax({url:this.url,type:"GET",success:function(c){return b[a.url]=c,a.template(c),a._loaded=!0,a.load()}}),this.initialize()}var b;return __extends(c,a),b={},c.extend=function(a){return Falcon.Class.extend(Falcon.View,a)},c.prototype._loaded=!1,c.prototype._loadQueue=[],c.prototype.url=null,c.prototype.template=null,c.prototype.initialize=function(){},c.prototype.viewModel=function(){var a,b,c;c={};for(a in this)b=this[a],a in Falcon.View.prototype||(c[a]=b);return c},c.prototype.isLoaded=function(){return this._loaded},c.prototype.load=function(a){if(a!=null)isFunction(a)||(a=function(){}),this._loaded?a():this._loadQueue.push(a);else if(this._loaded)while(!(this._loadQueue.length<=0))this._loadQueue.shift()();return this},c}(Falcon.Class),Falcon.Collection=function(a){function b(a,b){var c;b==null&&a instanceof Falcon.Model&&(c=[a,b],b=c[0],a=c[1]),this.model!=null&&this.url==null&&(this.url=this.model.prototype.url),this.parent=b,this._mappings=[],this.reset().add(a),this.initialize(a)}return __extends(b,a),b.prototype.list=null,b.prototype.model=null,b.prototype.url=null,b.prototype.length=0,b.prototype.parent=null,b._mappings=null,b.extend=function(a){return Falcon.Class.extend(Falcon.Collection,a)},b.prototype.initialize=function(){},b.prototype.data=function(a){var b,c,d,e;if(isEmpty(a)){c=[],e=this.list();for(b in e)d=e[b],d instanceof Falcon.Model||d instanceof Falcon.Collection?c[b]=d.data():c[b]=d;return c}return this.add(a),this},b.prototype.fetch=function(a){var b,c=this;isFunction(a)&&(a={success:a}),isObject(a)||(a={}),isObject(a.data)||(a.data={}),isFunction(a.success)||(a.success=function(){}),isFunction(a.error)||(a.error=function(){}),b=isFunction(this.url)?this.url():this.url;if(b==null||!isString(b))return;return $.ajax({url:trim(b),type:"GET",data:a.data,success:function(){var b,d,e;return b=1<=arguments.length?__slice.call(arguments,0):[],d=(e=b[0])!=null?e:{},isString(d)&&(d=JSON.parse(d)),c.add(d,a),a.success.apply(a,b)},error:a.error})},b.prototype.add=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this;if(this.model==null)return this;a==null&&(a=[]),b==null&&(b={}),a=this.parse(a),isObject(b)||(b={}),f=b.prepend,c=b.append,g=b.replace,isBoolean(f)||(f=!1),isBoolean(c)||(c=!1),isBoolean(g)||(g=!f&&!c);for(h=0,j=a.length;h<j;h++){d=a[h];if(!(d instanceof Falcon.Model||d instanceof Falcon.Collection))continue;d instanceof Falcon.Model&&d.on("destroy",function(a){return m.remove(a)}),l=this._mappings;for(i=0,k=l.length;i<k;i++)e=l[i],d.map(e)}if(g)this.reset().list(a);else if(f)while(a.length>0)this.list.unshift(a.pop());else if(c)while(a.length>0)this.list.push(a.shift());return this.length=this.list().length,this},b.prototype.remove=function(a){return isArray(a)?this.list.removeAll(a):this.list.remove(a),this},b.prototype.append=function(a){return this.add(a,{append:!0})},b.prototype.prepend=function(a){return this.add(a,{prepend:!0})},b.prototype.create=function(a,b){var c,d=this;if(this.model==null)return;return isFunction(b)&&(b={success:b}),isObject(b)||(b={}),c=b.success,b.success=function(a){return d.add(a,b),c.apply(a,arguments)},(new this.model(a,this.parent)).create(b)},b.prototype.at=function(a){var b;return isNumber(a)||(a=0),b=this.list(),a<0&&(a=0),a>=b.length&&(a=b.length-1),b[a]},b.prototype.map=function(a){var b,c,d,e,f,g,h=this;isObject(a)||(a={});for(b in a)d=a[b],isFunction(d)&&!ko.isObservable(d)&&(d=function(){var a;return a=d,function(){return a.call(arguments[0],arguments[0],h)}}()),a[b]=d;g=this.list();for(e=0,f=g.length;e<f;e++)c=g[e],Falcon.isDataObject(c)&&c.map(a);return this._mappings.push(a),this},b.prototype.parse=function(a){var b,c;isArray(a)||(a=[a]);if(this.model==null)return a;for(b in a)c=a[b],c instanceof Falcon.Model||(a[b]=new this.model(c,this.parent));return a},b.prototype.reset=function(){return this.list==null&&(this.list=ko.observableArray([])),this.list([]),this.length=this.list().length,this},b}(Falcon.Class),this.hfhfhfhfh=0,extend(ko.bindingHandlers,{view:function(){var getTemplate,getViewModel,makeTemplateValueAccessor;return makeTemplateValueAccessor=function(a){return function(){return{"if":a,data:a,templateEngine:ko.nativeTemplateEngine.instance}}},getViewModel=function(a){var b,c;return b={},a==null&&(a={}),a instanceof Falcon.View?b=a.viewModel():b=ko.utils.unwrapObservable((c=a.viewModel)!=null?c:{}),b},getTemplate=function(a){var b,c;return b="",a==null&&(a={}),a instanceof Falcon.View?b=a.template():b=ko.utils.unwrapObservable((c=a.template)!=null?c:{}),b},{init:function(a,b){var c,d;return c=b(),c=ko.utils.unwrapObservable(c),d=getViewModel(c),ko.bindingHandlers.template.init(a,makeTemplateValueAccessor(d))},update:function(){var args,element,template,value,valueAccessor,viewModel;element=arguments[0],valueAccessor=arguments[1],args=3<=arguments.length?__slice.call(arguments,2):[],value=valueAccessor(),value=ko.utils.unwrapObservable(value),viewModel=getViewModel(value),template=getTemplate(value);if(isEmpty(template))return;if(isEmpty(viewModel))return;if(ko.utils.domData.get(element,"__ko_view_updating__")===!0)return;return ko.utils.domData.set(element,"__ko_view_updating__",!0),defer(function(){var execScripts,originalTemplate,_ref;return execScripts=!!ko.utils.unwrapObservable(value.execScripts),template==null?$(element).html(""):(originalTemplate=ko.utils.domData.get(element,"__ko_anon_template__"),ko.utils.domData.set(element,"__ko_anon_template__",template),(_ref=ko.bindingHandlers.template).update.apply(_ref,[element,makeTemplateValueAccessor(viewModel)].concat(__slice.call(args))),template!==originalTemplate&&execScripts===!0&&$(element).find("script").each(function(index,script){script=$(script);if(script.attr("type").toLowerCase()==="text/javascript")return eval(script.text())})),ko.utils.domData.set(element,"__ko_view_updating__",!1)})}}}(),collection:function(){var a;return a=function(a){return a instanceof Falcon.Collection&&(a=a.data()),isArray(a)||(a=[]),function(){return a}},{init:function(){var b,c,d,e,f;return c=arguments[0],e=arguments[1],b=3<=arguments.length?__slice.call(arguments,2):[],d=e(),(f=ko.bindingHandlers.foreach).init.apply(f,[c,a(d)].concat(__slice.call(b)))},update:function(){var b,c,d,e,f;return c=arguments[0],e=arguments[1],b=3<=arguments.length?__slice.call(arguments,2):[],d=e(),(f=ko.bindingHandlers.foreach).update.apply(f,[c,a(d)].concat(__slice.call(b)))}}}()}),extend(ko.extenders,{hasState:function(a,b){var c,d,e,f,g,h;return isObject(b)||(b={initial:a()}),e=(h=b.initial)!=null?h:a(),g=ko.observable(e),f=ko.observable(null),d=a(),c=ko.observable(!1),a.subscribe(function(a){return f(d),d=a,c(!0)}),extend(a,{initial:e,saved:g,previous:f,changed:c,save:function(){return g(d),c(!1),a},revert:function(){return a(g()),c(!1),a}}),a}})})).call(this)