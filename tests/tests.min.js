((function(){var Falcon,arrayContains,arrayPeek,arraysEqual,compact,countSubstrings,defer,delay,endsWith,extend,isArray,isBoolean,isEmpty,isFunction,isNumber,isObject,isString,objectKeys,objectValues,objectsEqual,startsWith,trim,trimSlashes,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__slice=Array.prototype.slice;isObject=function(a){return typeof a==typeof {}&&a!==null},isFunction=function(a){return Object.prototype.toString.call(a)==="[object Function]"},isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"},isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},isString=function(a){return Object.prototype.toString.call(a)==="[object String]"},isNumber=function(a){return Object.prototype.toString.call(a)==="[object Number]"},isEmpty=function(a){var b,c;if(isObject(a)){for(b in a)return c=a[b],!1;return!0}return isString(a||isArray(a))?a.length===0:a===null||typeof a=="undefined"?!0:!1},trim=function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},trimSlashes=function(a){return a.replace(/^\//,"").replace(/\/$/,"")},startsWith=function(a,b){return a.indexOf(b)===0},endsWith=function(a,b){return a.indexOf(b,a.length-b.length)!==-1},countSubstrings=function(a,b){return a.split(b).length-1},objectKeys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},objectValues=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(c);return d},objectsEqual=function(a,b){var c,d;for(c in a){d=a[c];if(b[c]!==d)return!1}for(c in b){d=b[c];if(a[c]!==d)return!1}return!0},compact=function(a){var b,c,d;isObject(a)||(a={}),c={};for(b in a)d=a[b],d!=null&&(c[b]=d);return c},extend=function(a,b){var c,d;a==null&&(a={}),isObject(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},arraysEqual=function(a,b){var c,d,e;if(a.length!==b.length)return!1;for(c=0,e=a.length;c<e;c++){d=a[c];if(b[c]!==d)return!1}return!0},arrayPeek=function(a){return a[a.length-1]},arrayContains=function(a,b){var c,d,e;if(isFunction(a.indexOf))return a.indexOf(b)!==-1;if(isArray(a))for(d=0,e=a.length;d<e;d++){c=a[d];if(c===b)return!0}return!1},delay=function(a,b){var c;return isFunction(a)&&(c=[b,a],a=c[0],b=c[1]),isNumber(a)||(a=1),isFunction(b)||(b=function(){}),a<1&&(a=1),setTimeout(b,a)},defer=function(a){return isFunction(a)||(a=function(){}),setTimeout(a,1)},Falcon={version:"0.0.1",observable:ko.observable,computed:ko.computed,attr:function(a){return ko.observable(a).extend({hasState:!0})},apply:function(a){return $(function(){return $("body").attr("data-bind","view: $data"),ko.applyBindings(a)})},__layout__:null},this.Falcon=Falcon,Falcon.Class=function(){function a(){}return a.prototype["super"]=function(){},a.extend=function(a,b){var c,d;return a==null&&(a=Falcon.Class),c=null,b!=null&&b.hasOwnProperty("constructor")?c=b.constructor:c=function(){return this.__super__.apply(this,arguments)},d=function(){},d.prototype=a.prototype,c.prototype=new d,c.prototype.__super__=function(){return a.apply(this,arguments)},c.extend=function(a){return Falcon.Class.extend(c,a)},extend(c.prototype,b!=null?b:{}),c},a}(),Falcon.Model=function(a){function b(a,b){var c;b==null&&a instanceof Falcon.Model&&(c=[a,b],b=c[0],a=c[1]),this.id=ko.observable(0),this.parent=b,this.initialize(a),this.data(a)}return __extends(b,a),b.prototype._id=null,b.prototype._url="",b.extend=function(a){return Falcon.Class.extend(Falcon.Model,a)},b.prototype.url=null,b.prototype.parent=null,b.prototype.initialize=function(){},b.prototype.data=function(a){var b,c,d,e;if(isEmpty(a)){c={};for(b in this)d=this[b],b in Falcon.Model.prototype||(d instanceof Falcon.Model||d instanceof Falcon.Collection?c[b]=d.data():c[b]=d);return c}isObject(a)||(a={}),e=[];for(b in a)d=a[b],e.push(this.set(b,d));return e},b.prototype.get=function(a){var b;if(!isString(a))return;return b=this[a],ko.isObservable(b)?ko.utils.unwrapObservable(b):b},b.prototype.set=function(a,b){var c,d;return a==null||a in Falcon.Model.prototype?this:(ko.isObservable(b)&&(b=ko.utils.unwrapObservable(b)),c=(d=this[a])!=null?d:this[a]=ko.observable(),c instanceof Falcon.Model||c instanceof Falcon.Collection?c.data(b):ko.isObservable(c)&&c(b),this)},b.prototype.sync=function(a,b){var c,d,e,f=this;isFunction(b)&&(b={complete:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),isFunction(b.error)||(b.error=function(){}),isFunction(b.complete)||(b.complete=function(){}),a=isString(a)?a.toUpperCase():"GET",a!=="GET"&&a!=="POST"&&a!=="PUT"&&a!=="DELETE"&&(a="GET"),a=trim(a),console.log("HERE",this.url),e=trim(isFunction(this.url)?this.url():this.url),c="",d=e.lastIndexOf("."),d>-1&&(c=e.slice(d),e=e.slice(0,d));if(a==="GET"||a==="PUT"||a==="DELETE")e.slice(-1)!=="/"&&(e+="/"),e+=this.id();return $.ajax({url:""+e+c,type:a,data:this.toJSON(),error:function(){return b.error.apply(b,arguments)},success:function(a){return f.data(a),b.success.apply(b,arguments)},complete:function(){return b.complete.apply(b,arguments)}})},b.prototype.fetch=function(a){return this.sync("GET",a)},b.prototype.create=function(a){return this.sync("POST",a)},b.prototype.save=function(a){return this.sync("PUT",a)},b.prototype["delete"]=function(a){return this.sync("DELETE",a)},b.prototype.toJS=function(){var a;return(a=function(b){var c,d,e;b=ko.utils.unwrapObservable(b);if(isArray(b))return function(){var c,d,f;f=[];for(c=0,d=b.length;c<d;c++)e=b[c],f.push(a(e));return f}();if(isObject(b)){d={};for(c in b)e=b[c],d[c]=a(e);return d}return b})(this.data())},b.prototype.toJSON=function(){return ko.utils.stringifyJson(this.toJS())},b}(Falcon.Class),Falcon.View=function(a){function c(){var a=this;this.template=ko.observable(ko.utils.unwrapObservable(this.template)),isString(this.url)||(this.url=""),this.url=trim(this.url),this._loaded=!1,isEmpty(this.url)?this._loaded=!0:this.url in b?(this._loaded=!0,this.template(b[this.url])):$.ajax({url:this.url,type:"GET",success:function(c){return b[a.url]=c,a.template(c),a._loaded=!0,a.load()}}),this.initialize()}var b;return __extends(c,a),b={},c.extend=function(a){return Falcon.Class.extend(Falcon.View,a)},c.prototype._loaded=!1,c.prototype._loadQueue=[],c.prototype.url=null,c.prototype.template=null,c.prototype.initialize=function(){},c.prototype.viewModel=function(){var a,b,c;c={};for(a in this)b=this[a],a in Falcon.View.prototype||(c[a]=b);return c},c.prototype.isLoaded=function(){return this._loaded},c.prototype.load=function(a){if(a!=null)isFunction(a)||(a=function(){}),this._loaded?a():this._loadQueue.push(a);else if(this._loaded)while(!(this._loadQueue.length<=0))this._loadQueue.shift()();return this},c}(Falcon.Class),Falcon.Collection=function(a){function b(a,b){var c;b==null&&a instanceof Falcon.Model&&(c=[a,b],b=c[0],a=c[1]),this.parent=b,this.reset().add(a),this.initialize(a)}return __extends(b,a),b.prototype.list=null,b.prototype.model=null,b.prototype.url=null,b.prototype.length=0,b.prototype.parent=null,b.extend=function(a){return Falcon.Class.extend(Falcon.Collection,a)},b.prototype.initialize=function(a){},b.prototype.data=function(a){var b,c,d,e,f;c=ko.observableArray(["Hello","World"]);if(isEmpty(a)){d=[],f=this.list();for(b in f)e=f[b],e instanceof Falcon.Model||e instanceof Falcon.Collection?d[b]=e.data():d[b]=e;return d}return this.add(a),this},b.prototype.fetch=function(a){var b,c=this;isFunction(a)&&(a={success:a}),isObject(a)||(a={}),isObject(a.data)||(a.data={}),isFunction(a.success)||(a.success=function(){}),isFunction(a.error)||(a.error=function(){}),b=isFunction(this.url)?this.url():this.url;if(b==null||!isString(b))return;return $.ajax({url:trim(b),type:"GET",data:a.data,success:function(){var b,d,e;return b=1<=arguments.length?__slice.call(arguments,0):[],d=(e=b[0])!=null?e:{},isString(d)&&(d=JSON.parse(d)),c.add(d,a),a.success.apply(a,b)},error:a.error})},b.prototype.add=function(a,b){var c,d,e;if(this.model==null)return this;a==null&&(a=[]),b==null&&(b={}),a=this.parse(a),isObject(b)||(b={}),d=b.prepend,c=b.append,e=b.replace,isBoolean(d)||(d=!1),isBoolean(c)||(c=!1),isBoolean(e)||(e=!d&&!c);if(e)this.reset().list(a);else if(d)while(a.length>0)this.list.unshift(a.pop());else if(c)while(a.length>0)this.list.push(a.shift());return this.length=this.list().length,this},b.prototype.append=function(a){return this.add(a,{append:!0})},b.prototype.prepend=function(a){return this.add(a,{prepend:!0})},b.prototype.parse=function(a){var b,c;isArray(a)||(a=[a]);if(this.model==null)return a;for(b in a)c=a[b],c instanceof Falcon.Model||(a[b]=new this.model(c,this.parent));return a},b.prototype.reset=function(){return this.list==null&&(this.list=ko.observableArray([])),this.list([]),this.length=this.list().length,this},b}(Falcon.Class),extend(ko.bindingHandlers,{view:function(){var getTemplate,getViewModel,makeTemplateValueAccessor;return makeTemplateValueAccessor=function(a){return function(){return{"if":a,data:a,templateEngine:ko.nativeTemplateEngine.instance}}},getViewModel=function(a){var b,c;return b={},a==null&&(a={}),a instanceof Falcon.View?b=a.viewModel():b=ko.utils.unwrapObservable((c=a.viewModel)!=null?c:{}),b},getTemplate=function(a){var b,c;return b="",a==null&&(a={}),a instanceof Falcon.View?b=a.template():b=ko.utils.unwrapObservable((c=a.template)!=null?c:{}),b},{init:function(a,b){var c,d;return c=b(),c=ko.utils.unwrapObservable(c),d=getViewModel(c),ko.bindingHandlers.template.init(a,makeTemplateValueAccessor(d))},update:function(){var args,element,template,value,valueAccessor,viewModel;element=arguments[0],valueAccessor=arguments[1],args=3<=arguments.length?__slice.call(arguments,2):[],value=valueAccessor(),value=ko.utils.unwrapObservable(value),viewModel=getViewModel(value),template=getTemplate(value);if(isEmpty(template))return;if(isEmpty(viewModel))return;if(ko.utils.domData.get(element,"__ko_view_updating__")===!0)return;return ko.utils.domData.set(element,"__ko_view_updating__",!0),defer(function(){var execScripts,originalTemplate,_ref;return execScripts=!!ko.utils.unwrapObservable(value.execScripts),template==null?$(element).html(""):(originalTemplate=ko.utils.domData.get(element,"__ko_anon_template__"),ko.utils.domData.set(element,"__ko_anon_template__",template),(_ref=ko.bindingHandlers.template).update.apply(_ref,[element,makeTemplateValueAccessor(viewModel)].concat(__slice.call(args))),template!==originalTemplate&&execScripts===!0&&$(element).find("script").each(function(index,script){script=$(script);if(script.attr("type").toLowerCase()==="text/javascript")return eval(script.text())})),ko.utils.domData.set(element,"__ko_view_updating__",!1)})}}}(),collection:function(){var a;return a=function(a){return a instanceof Falcon.Collection&&(a=a.data()),isArray(a)||(a=[]),function(){return a}},{init:function(){var b,c,d,e,f;return c=arguments[0],e=arguments[1],b=3<=arguments.length?__slice.call(arguments,2):[],d=e(),(f=ko.bindingHandlers.foreach).init.apply(f,[c,a(d)].concat(__slice.call(b)))},update:function(){var b,c,d,e,f;return c=arguments[0],e=arguments[1],b=3<=arguments.length?__slice.call(arguments,2):[],d=e(),(f=ko.bindingHandlers.foreach).update.apply(f,[c,a(d)].concat(__slice.call(b)))}}}()}),extend(ko.extenders,{hasState:function(a,b){var c,d,e,f,g,h;return isObject(b)||(b={initial:a()}),e=(h=b.initial)!=null?h:a(),g=ko.observable(e),f=ko.observable(null),d=a(),c=ko.observable(!1),a.subscribe(function(a){return f(d),d=a,c(!0)}),extend(a,{initial:e,saved:g,previous:f,changed:c,save:function(){return g(d),c(!1),a},revert:function(){return a(g()),c(!1),a}}),a}})})).call(this)