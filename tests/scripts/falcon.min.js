/*
	Falcon.js
	by Rick Allen (stoodder)

	Version 1.0.0rc1
	Full source at https://github.com/stoodder/falconjs
	Copyright (c) 2014 Rick Allen, http://www.stoodder.com

	MIT License, https://github.com/stoodder/falconjs/blob/master/LICENSE.md
*/


(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=[].slice,J={}.hasOwnProperty,K=function(a,b){function c(){this.constructor=a}for(var d in b)J.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},L=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};s=function(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)},p=function(a){return null!=a&&"[object Function]"===Object.prototype.toString.call(a)},m=function(a){return null!=a&&"[object Boolean]"===Object.prototype.toString.call(a)},l=function(a){return null!=a&&"[object Array]"===Object.prototype.toString.call(a)},t=function(a){return null!=a&&"[object String]"===Object.prototype.toString.call(a)},r=function(a){return null!=a&&"[object Number]"===Object.prototype.toString.call(a)},q=function(a){return r(a)&&a!==a},o=function(a){var b,c;if(null==a)return!0;if(t(a))return 0===v(a).length;if(l(a))return 0===a.length;if(s(a)){for(b in a)return c=a[b],!1;return!0}return!1},n="object"==typeof HTMLElement?function(a){return a instanceof HTMLElement}:function(a){return null!=a&&1===a.nodeType&&"string"==typeof a.nodeName},v=String.prototype.trim?function(a){return String.prototype.trim.call(a)}:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},w=function(a){return a.replace(/^[\\/\s]+/,"").replace(/[\\/\s]+$/,"")},i=function(a,b){var c;return c=function(){return a.apply(b,arguments)},c.__falcon_bind__length__=a.length,c},j=function(a){var b,c,d;if(!s(a))return a;if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return b="",null!=a.global&&(b+="g"),null!=a.ignoreCase&&(b+="i"),null!=a.multiline&&(b+="m"),null!=a.sticky&&(b+="y"),new RegExp(a.source,b);d=new a.constructor;for(c in a)d[c]=j(a[c]);return d},k=function(a){var b;return null==a&&(a=[]),function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.cloneNode(!0));return e}()},f=function(){function b(){var b,c,d,e,f,g,h,i;if(s(this.defaults)){d=this.defaults;for(b in d)c=d[b],this[b]=p(c)?c.apply(this,arguments):s(c)?j(c):l(c)?c.slice(0):c}if(s(this.observables)){e=this.observables;for(b in e)c=e[b],this[b]=p(c)?ko.computed({read:c,owner:this,deferEvaluation:null!=(f=a.deferEvaluation)?f:!0}):s(c)&&("read"in c||"write"in c)?ko.computed({read:c.read,write:c.write,owner:null!=(g=c.owner)?g:this,deferEvaluation:null!=(h=null!=(i=c.deferEvaluation)?i:a.deferEvaluation)?h:!0,disposeWhen:c.disposeWhen,disposeWhenNodeIsRemoved:c.disposeWhenNodeIsRemoved}):l(c)?ko.observableArray(c.slice(0)):ko.observable(c)}}return b.prototype.observables=null,b.prototype.defaults=null,b.extend=function(a,b){var c,d,e,f,g;f=this,d=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return f.apply(this,arguments)};for(e in f)g=f[e],d[e]=g;for(e in b)g=b[e],d[e]=g;c=function(){this.constructor=d},c.prototype=f.prototype,d.prototype=new c;for(e in a)g=a[e],d.prototype[e]=g;return d.__super__=f.prototype,d},b.prototype.__falcon_object__events__=null,b.prototype.__falcon_object__listeners__=null,b.prototype.on=function(a,b,c,d){var e;return t(a)&&p(b)?(null==c&&(c=this),null==d&&(d=-1),a=v(a).toLowerCase(),o(a)?this:(null==this.__falcon_object__events__&&(this.__falcon_object__events__={}),(null!=(e=this.__falcon_object__events__)[a]?(e=this.__falcon_object__events__)[a]:e[a]=[]).push({callback:b,context:c,allowance:d}),this)):this},b.prototype.once=function(a,b,c){return this.on(a,b,c,1)},b.prototype.off=function(a,b,c){var d,e,f,g,h=this;if(!s(this.__falcon_object__events__))return this;if(t(a)||(f=[a,b,null],b=f[0],c=f[1],a=f[2]),p(b)||(g=[b,null],c=g[0],b=g[1]),t(a)&&(a=v(a).toLowerCase()),d=function(a){return null!=b&&a.callback!==b?!0:null!=c&&a.context!==c?!0:!1},e=function(a){var b,c;return c=h.__falcon_object__events__[a],l(c)?(c=function(){var a,e,f;for(f=[],a=0,e=c.length;e>a;a++)b=c[a],d(b)&&f.push(b);return f}(),h.__falcon_object__events__[a]=c.length<=0?null:c):void 0},t(a))e(a);else for(a in this.__falcon_object__events__)e(a);return this},b.prototype.has=function(a,b){var c,d,e,f;if(!t(a))return!1;if(a=v(a).toLowerCase(),null==this.__falcon_object__events__&&(this.__falcon_object__events__={}),o(a)||null==this.__falcon_object__events__[a])return!1;if(null!=this.__falcon_object__events__[a]&&!p(b))return!0;for(f=this.__falcon_object__events__[a],d=0,e=f.length;e>d;d++)if(c=f[d],c.callback===b)return!0;return!1},b.prototype.trigger=function(){var a,b,c,d,e,f,g;if(b=arguments[0],a=2<=arguments.length?I.call(arguments,1):[],!t(b))return this;if(b=v(b).toLowerCase(),null==this.__falcon_object__events__&&(this.__falcon_object__events__={}),o(b)||null==this.__falcon_object__events__[b])return this;for(d=[],g=this.__falcon_object__events__[b],e=0,f=g.length;f>e;e++)c=g[e],0!==c.allowance&&(d.push(c),c.callback.apply(c.context,a)),c.allowance>0&&c.allowance--;return this.__falcon_object__events__[b]=d,this},b.prototype.listenTo=function(b,c,d){return a.isFalconObject(b)?t(c)&&p(d)?(b.on(c,d,this),null==this.__falcon_object__listeners__&&(this.__falcon_object__listeners__=[]),this.__falcon_object__listeners__.push({object:b,event:c,callback:d}),this):this:this},b.prototype.listenToOnce=function(b,c,d){return a.isFalconObject(b)?t(c)&&p(d)?(b.once(c,d,this),null==this.__falcon_object__listeners__&&(this.__falcon_object__listeners__=[]),this.__falcon_object__listeners__.push({object:b,event:c,callback:d}),this):this:this},b.prototype.stopListening=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o;for(t(b)&&(l=[b,c,null],c=l[0],d=l[1],b=l[2]),p(b)&&(m=[b,null],d=m[0],b=m[1]),p(c)&&(n=[c,null],d=n[0],c=n[1]),h=t(c)?c:null,k=a.isFalconObject(b)?b:null,g=p(d)?d:null,null==this.__falcon_object__listeners__&&(this.__falcon_object__listeners__=[]),f=[],o=this.__falcon_object__listeners__,i=0,j=o.length;j>i;i++)e=o[i],b=e.object,c=e.event,d=e.callback,null!=h&&c!==h?f.push(e):null!=k&&b!==k?f.push(e):null!=g&&d!==g?f.push(e):b.off(c,d,this);return this.__falcon_object__listeners__=f,this},b}(),d=function(b){function c(){return A=c.__super__.constructor.apply(this,arguments)}var d;return K(c,b),c.extend=f.extend,c.prototype.resolveRequestType=function(b,c){return t(c)?(c=v(c).toUpperCase(),L.call(a.REQUEST_TYPES,c)<0?a.GET:c):a.GET},c.prototype.resolveContext=function(a,b,c,d){var e;return null!=(e=null!=d?d:c.context)?e:a},d=function(){function a(a){var b,c;if(s(a))for(b in a)c=a[b],this[b]=c;else p(a)?this.complete=a:t(a)?this.attributes=v(a).split(","):l(a)&&(this.attributes=a)}return a.prototype.id=void 0,a.prototype.url=null,a.prototype.data=null,a.prototype.parent=void 0,a.prototype.attributes=null,a.prototype.fill_options=null,a.prototype.success=function(){},a.prototype.complete=function(){},a.prototype.error=function(){},a}(),c.prototype.standardizeOptions=function(b,c,e,f){return e instanceof d?e:(e=new d(e),a.isModel(e.parent)||null===e.parent||(e.parent=b.parent),e.url=this.resolveUrl(b,c,e,f),e.data=this.serializeData(b,c,e,f),e)},c.prototype.resolveUrl=function(a,b,c){var d;return null!=(d=c.url)?d:a.makeUrl(b,c.parent)},c.prototype.makeBaseUrl=function(b,c,d){var e,f,g,h,i;for(h=void 0===d.parent?b.parent:d.parent,f=[];a.isModel(h);)e=p(h.endpoint)?h.endpoint(a.GET,h.parent):h.endpoint,t(e)||(e=""),i=e.lastIndexOf("."),i>-1&&(e=e.slice(0,i)),f.unshift(w(e)+"/"+h.get("id")),h=h.parent;return g="/"+f.join("/")+"/",t(a.baseApiUrl)&&(g=""+a.baseApiUrl+g),g.replace(/([^:])\/\/+/gi,"$1/").replace(/^\/\//gi,"/")},c.prototype.makeUrlComponents=function(b,c,d,e){var f,g,h,i,j,k,l;return c=this.resolveRequestType(b,c,d,e),f=this.makeBaseUrl(b,c,d,e),g=p(b.endpoint)?b.endpoint(c,d.parent):b.endpoint,g=t(g)?w(g):"",h="",j=g.lastIndexOf("."),k=g.lastIndexOf("/"),j>k&&(h=g.slice(j),g=g.slice(0,j)),i=a.isModel(b)?""+(null!=(l=d.id)?l:b.get("id")):null,{base_url:f,endpoint:g,id:i,extension:h}},c.prototype.makeUrl=function(b,c,d,e){var f,g,h,i,j;return j=this.makeUrlComponents(b,c,d,e),f=j.base_url,g=j.endpoint,i=j.id,h=j.extension,a.isModel(b)?c===a.POST?""+f+g+h:""+f+g+"/"+i+h:a.isCollection(b)?""+f+g+h:void 0},c.prototype.serializeData=function(b,c,d){return null!=d.data||c!==a.POST&&c!==a.PUT?d.data:b.serializeRequestData(c,d)},c.prototype.parseRawResponseData=function(a,b,c,d,e){return e},c.prototype.successResponseHandler=function(b,c,d,e,f){var g,h;switch(h=this.parseRawResponseData(b,c,d,e,f),g=b.parseResponseData(h,c,d),b.fill(g,d.fill_options),c){case a.GET:b.trigger("fetch",g);break;case a.POST:b.trigger("create",g);break;case a.PUT:b.trigger("save",g);break;case a.DELETE:b.trigger("destroy",g)}return d.success.call(e,b,h,d,f)},c.prototype.errorResponseHandler=function(a,b,c,d,e){var f;return f=this.parseRawResponseData(a,b,c,d,e),c.error.call(d,a,f,c,e)},c.prototype.completeResponseHandler=function(a,b,c,d,e){var f;return f=this.parseRawResponseData(a,b,c,d,e),c.complete.call(d,a,f,c,e)},c.prototype.sync=function(b,c,d,e){var f;if(!a.isDataObject(b))throw new Error("Expected data_object to be a Model or Collection");return f=!1,c=this.resolveRequestType(b,c,d,e),d=this.standardizeOptions(b,c,d,e),e=this.resolveContext(b,c,d,e),!a.isModel(b)||c!==a.POST&&c!==a.PUT||b.validate(d)?(f=!0,{data_object:b,type:c,options:d,context:e,is_valid:f}):{data_object:b,type:c,options:d,context:e,is_valid:f}},c}(f),g=function(b){function c(){this.__falcon_templateAdapter__cache__={},c.__super__.constructor.apply(this,arguments),document.createElement("template")}return K(c,b),c.prototype.__falcon_templateAdapter__is_loaded__=!1,c.prototype.__falcon_templateAdapter__load_routines__=null,c.prototype.__falcon_templateAdapter__cache__=null,c.extend=f.extend,c.prototype.addLoadRoutine=function(a){return this.__falcon_templateAdapter__is_loaded__?a():(null!=this.__falcon_templateAdapter__load_routines__?this.__falcon_templateAdapter__load_routines__:this.__falcon_templateAdapter__load_routines__=[]).push(a)},c.prototype.executeLoadRoutines=function(){var a,b,c,d,e;if(!this.__falcon_templateAdapter__is_loaded__&&(this.__falcon_templateAdapter__is_loaded__=!0,null!=this.__falcon_templateAdapter__load_routines__)){for(d=this.__falcon_templateAdapter__load_routines__,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a());return e}},c.prototype.cacheTemplate=function(a,b){if(!t(a))throw new Error("identifier must be a string");if(!t(b))throw new Error("template must be a string");return this.__falcon_templateAdapter__cache__[a]=b,this},c.prototype.getCachedTemplate=function(a){var b;if(!t(a))throw new Error("identifier must be a string");return null!=(b=this.__falcon_templateAdapter__cache__[a])?b:null},c.prototype.resetCache=function(){return this.__falcon_templateAdapter__cache__={},this},c.prototype.cacheAllTemplates=function(){var b,c,d,e,f,g;for(d=function(){var a,b,d,e;for(d=document.getElementsByTagName("template"),e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c);return e}(),e=0,f=d.length;f>e;e++)c=d[e],b=c.getAttribute("id"),null!=b&&a.templateAdapter.cacheTemplate("#"+b,c.innerHTML),null!=(g=c.parentNode)&&g.removeChild(c);return this},c.prototype.resolveTemplate=function(b,c){var d,e=this;if(!a.isView(b))throw new Error("view must be a Falcon.View");if(!p(c))throw new Error("callback must be a function");return t(b.template)?(c(b.template),this):(d=b.makeUrl(),o(d)?(c(""),this):(this.addLoadRoutine(function(){var a;return a=e.getCachedTemplate(d),a?c(a):e.loadTemplate(d,c)}),this))},c.prototype.loadTemplate=function(a,b){var c,d;if(!t(a))throw new Error("url must be a String");if(!p(b))throw new Error("callback must be a function");return c=document.getElementById(a.slice(1)),null==c?(b(""),this):(d=c.innerHTML,t(d)||(d=""),this.cacheTemplate(a,d),b(d),this)},c.prototype.makeUrl=function(b){var c,d;if(!a.isView(b))throw new Error("view must be an instanceof Falcon.View");return c=ko.unwrap(b.endpoint),p(c)&&(c=c.call(b)),c=t(c)?v(c):"",o(c)?c:"#"===c.charAt(0)?c:(d="/"===c.charAt(0)?c:"/"+c,t(a.baseTemplateUrl)&&(d=""+a.baseTemplateUrl+d),d=d.replace(/([^:])\/\/+/gi,"$1/"))},c}(f),e=function(b){function c(b,d){var e,f;if(c.__super__.constructor.apply(this,arguments),b=ko.unwrap(b),d=ko.unwrap(d),null!=d&&!a.isModel(d)&&a.isModel(b)&&(e=[b,d],d=e[0],b=e[1]),null==d&&a.isModel(b)&&(f=[b,d],d=f[0],b=f[1]),null!=d&&!a.isModel(d))throw new Error("parent must be null or a Falcon.Model");return this.__falcon_model__is_null__=ko.observable(!1),this.parent=d,this.initialize.apply(this,arguments),o(b)||this.fill(b),this}return K(c,b),c.extend=f.extend,c.prototype.id=null,c.prototype.endpoint=null,c.prototype.parent=null,c.prototype.__falcon_model__is_null__=!1,c.prototype.initialize=function(){},c.prototype.get=function(a){return t(a)?ko.unwrap(this[a]):void 0},c.prototype.set=function(a,b){var c,d;if(s(a)){for(c in a)d=a[c],this.set(c,d);return this}return t(a)?(ko.isObservable(this[a])?this[a](b):this[a]=b,this):this},c.prototype.toggle=function(a){return this.set(a,!this.get(a))},c.prototype.increment=function(a){return this.set(a,this.get(a)+1),this},c.prototype.decrement=function(a){return this.set(a,this.get(a)-1),this},c.prototype.serializeRequestData=function(a,b){return this.serialize(b.attributes)},c.prototype.parseResponseData=function(a){return a},c.prototype.fill=function(b){var c,d,e,f;if(this.__falcon_model__is_null__(null===b),(r(b)||t(b))&&(b={id:b}),!s(b))return this;if(o(b))return this;d={},f=a.Model.prototype;for(c in f)e=f[c],"id"!==c&&"endpoint"!==c&&(d[c]=!0);for(c in b)e=b[c],d[c]||(e=ko.unwrap(e),a.isModel(this[c])?a.isModel(e)?this[c]=e:this[c].fill(e):a.isCollection(this[c])?a.isCollection(e)?this[c]=e:this[c].fill(e):ko.isWriteableObservable(this[c])?this[c](e):p(this[c])?"endpoint"===c&&(this[c]=e):this[c]=e);return this},c.prototype.unwrap=function(){var b,c,d;c={};for(b in this)d=this[b],"id"!==b&&b in a.Model.prototype||(c[b]=a.isDataObject(d)?d.unwrap():d);return c},c.prototype.serialize=function(b){var c,d,e,f,g,h,i;if(e={},null==b?b=function(){var b;b=[];for(c in this)"id"!==c&&c in a.Model.prototype||b.push(c);return b}.call(this):t(b)&&(b=v(b).split(",")),l(b)){for(d={},h=0,i=b.length;i>h;h++)c=b[h],d[c]=null;b=d}if(!s(b))return e;for(c in b)f=b[c],g=this[c],a.isDataObject(g)?e[c]=g.serialize(f):ko.isObservable(g)?e[c]=ko.unwrap(g):p(g)||(e[c]=g);return e},c.prototype.makeUrl=function(b,c,d){var e;return void 0===d&&(t(c)||r(c))&&(e=[d,c],c=e[0],d=e[1]),a.dataAdapter.makeUrl(this,b,{parent:c,id:d},this)},c.prototype.validate=function(){return!0},c.prototype.sync=function(b,c,d){return a.dataAdapter.sync(this,b,c,d)},c.prototype.fetch=function(b,c){return this.sync(a.GET,b,c)},c.prototype.create=function(b,c){return this.sync(a.POST,b,c)},c.prototype.save=function(b,c){return this.isNew()?this.create(b,c):this.sync(a.PUT,b,c)},c.prototype.destroy=function(b,c){return this.sync(a.DELETE,b,c)},c.prototype.equals=function(b){var c,d;return b=ko.unwrap(b),a.isModel(b)?(c=this.get("id"),d=b.get("id"),null!=c&&null!=d?b.get("id")===this.get("id"):b===this):r(b)||t(b)?b===this.get("id"):!1},c.prototype.mixin=function(b){var c,d,e;s(b)||(b={});for(c in b)d=b[c],a.isDataObject(this[c])?this[c].mixin(d):ko.isObservable(d)?ko.isObservable(this[c])||(this[c]=ko.observable(null!=(e=this.get(c))?e:ko.unwrap(d))):p(d)?this[c]=i(d,this):null==this[c]&&(this[c]=d);return this},c.prototype.clone=function(b,c){var d;return(null===b||a.isModel(b))&&(d=[void 0,b],b=d[0],c=d[1]),null===c||a.isModel(c)||(c=this.parent),new this.constructor(this.serialize(b),c)},c.prototype.isNew=function(){return null==this.get("id")},c.prototype.isNull=function(){return this.__falcon_model__is_null__()},c}(f),b=function(b){function c(b,d){var e,f,g=this;if(c.__super__.constructor.apply(this,arguments),b=ko.unwrap(b),d=ko.unwrap(d),null==d&&a.isModel(b)&&(e=[b,d],d=e[0],b=e[1]),a.isModel(b)&&l(d)&&(f=[b,d],d=f[0],b=f[1]),null!=d&&!a.isModel(d))throw new Error("parent must be null or a Falcon.Model");return null!=this.model&&null==this.endpoint&&(this.endpoint=this.model.prototype.endpoint),this.length=ko.computed({deferEvaluation:a.deferEvaluation,read:function(){return g.models().length}}),this.parent=d,this.__falcon_collection__mixins__=[],this.models=ko.observableArray([]),this.initialize.apply(this,arguments),o(b)||this.replace(b),this}var d,e,g,h,i,j,k,n;return K(c,b),c.extend=f.extend,k=function(b){var c,d,e;return b=ko.unwrap(b),a.isCollection(b)&&(b=b.models()),a.isModel(b)?(d=b,e=d.get("id"),null!=e?function(b){var c,e;return a.isModel(b)?(c=b.get("id"),e=d.get("id"),c===e):!1}:function(b){return a.isModel(b)?b===d:!1}):r(b)||t(b)?(c=b,function(b){return a.isModel(b)?b.get("id")===c:!1}):l(b)?function(a){return L.call(b,a)>=0}:b},c.prototype.__falcon_collection__mixins__=null,c.prototype.models=null,c.prototype.model=null,c.prototype.endpoint=null,c.prototype.length=0,c.prototype.parent=null,c.prototype.comparator=null,c.prototype.initialize=function(){},c.prototype.set=function(a,b){return this.each(function(c){return c.set(a,b)}),this},c.prototype.serializeRequestData=function(a,b){return this.serialize(b.attributes)},c.prototype.parseResponseData=function(a){return a},c.prototype.unwrap=function(){var b,c,d,e;c=[],e=this.models();for(b in e)d=e[b],c[b]=a.isDataObject(d)?d.unwrap():d;return c},c.prototype.serialize=function(b){var c,d,e,f;d=[],f=this.models();for(c in f)e=f[c],d[c]=a.isDataObject(e)?e.serialize(b):e;return d},c.prototype.makeUrl=function(b,c){return a.dataAdapter.makeUrl(this,b,{parent:c},this)},c.prototype.sync=function(b,c,d){return a.dataAdapter.sync(this,b,c,d)},c.prototype.fetch=function(b,c){return this.sync(a.GET,b,c)},c.prototype.create=function(b,c,d){var e,f,g=this;return null==this.model?null:(s(b)||a.isModel(b)||(b={}),e=a.isModel(b)?b:new this.model(b,this.parent),null==d&&(d=e),f=a.dataAdapter.standardizeOptions(e,a.POST,c,d),null==f.fill_options&&(f.fill_options={method:"append"}),f.success=function(a){return g.fill(a,f.fill_options),p(c.success)?c.success.apply(d,arguments):void 0},e.create(f,d))},c.prototype.destroy=function(b,c,d){var e,f=this;return null==this.model?null:(b=this.first(ko.unwrap(b)),a.isModel(b)?(null==d&&(d=b),e=a.dataAdapter.standardizeOptions(b,a.DELETE,c,d),e.success=function(a){return f.remove(a),p(c.success)?c.success.apply(d,arguments):void 0},b.destroy(e,d)):null)},c.prototype.remove=function(b){var c;return b=ko.unwrap(b),a.isCollection(b)&&(b=b.models()),c=l(b)?this.models.removeAll(b):this.models.remove(k(b)),this},h=function(b,c){return ko.isObservable(c)&&(c=ko.unwrap(c)),null==c&&(c=[]),a.isCollection(c)&&(c=c.all()),l(c)||(c=[c]),c=c.slice(0)},g=function(b,c){var d,e,f,g;for(d=f=0,g=c.length;g>f;d=++f)e=c[d],s(e)&&!a.isModel(e)&&(c[d]=new b.model(e,b.parent));return c},e=function(a,b){var c,d,e,f,g,h,i;for(e=0,g=b.length;g>e;e++)for(c=b[e],i=a.__falcon_collection__mixins__,f=0,h=i.length;h>f;f++)d=i[f],c.mixin(d);return b},i=function(a,b){var c,d,e,f;s(b)||(b={}),d={};for(c in b)e=b[c],d[c]=e;return null==d.comparator&&(d.comparator=a.comparator),t(d.method)||(d.method="replace"),d.method=v(d.method.toLowerCase()),"replace"!==(f=d.method)&&"append"!==f&&"prepend"!==f&&"insert"!==f&&"merge"!==f&&(d.method="replace"),d},j=function(a,b,c){return p(c.comparator)&&b.sort(c.comparator),a.models(b)},c.prototype.fill=function(a,b){return b=i(this,b),this[b.method](a,b)},c.prototype.replace=function(a,b){return null==this.model?[]:(b=i(this,b),a=h(this,a),a=g(this,a),e(this,a),j(this,a,b),a)},c.prototype.append=function(a,b){return null==this.model?[]:(b=i(this,b),a=h(this,a),a=g(this,a),e(this,a,b),j(this,this.models().concat(a),b),a)},c.prototype.prepend=function(a,b){return null==this.model?[]:(b=i(this,b),a=h(this,a),a=g(this,a),e(this,a,b),j(this,a.concat(this.models()),b),a)},c.prototype.insert=function(b,c){var d,f,l,m,n,o;return p(c)&&(c={iterator:c}),(r(c)||t(c)||a.isModel(c))&&(c={model:c}),c=i(this,c),b=h(this,b),b=g(this,b),e(this,b,c),f=null!=(n=c.index)?n:this.indexOf(k(null!=(o=c.iterator)?o:c.model)),l=this.models(),0>f||f>=l.length?l=l.concat(b):(d=l.slice(0,f),m=l.slice(f),l=d.concat(b,m)),j(this,l,c),b},c.prototype.merge=function(b,c){var d,f,g,l,m,n,o,p,q,r,t,u,v;if(null==this.model)return[];for(c=i(this,c),b=h(this,b),d=[],o=this.models(),p=0,t=b.length;t>p;p++)if(g=b[p],f=null,a.isModel(g)){for(l=k(g),q=0,u=o.length;u>q;q++)if(m=o[q],l(m)){f=m;break}a.isModel(f)?f.fill(g.unwrap()):(o.push(g),d.push(g))}else if(s(g)){for(l=k(g.id),r=0,v=o.length;v>r;r++)if(m=o[r],l(m)){f=m;break}a.isModel(f)?f.fill(g):(n=new this.model(g,this.parent),o.push(n),d.push(n))}return e(this,d),j(this,o,c),d},c.prototype.unshift=function(){return this.prepend.apply(this,arguments)},c.prototype.shift=function(){var a;return a=this.models.shift()},c.prototype.push=function(){return this.append.apply(this,arguments)},c.prototype.pop=function(){var a;return a=this.models.pop()},c.prototype.sort=function(a){return null==a&&(a=this.comparator),p(a)?(this.models.sort(a),this):this},c.prototype.at=function(a){var b;return a=parseInt(a),q(a)?null:(b=this.models(),0>a||a>=b.length?null:b[a])},c.prototype.indexOf=function(b){var c,d,e,f,g;if(a.isModel(b))return this.models.indexOf(b);if(d=k(b),!p(d))return-1;for(g=this.models(),c=e=0,f=g.length;f>e;c=++e)if(b=g[c],d(b))return c;return-1},c.prototype.lastIndexOf=function(a){var b,c,d,e,f,g,h;if(d=k(a),!p(d))return-1;for(f=this.models(),e=f.length,b=g=0,h=f.length;h>g;b=++g)if(a=f[b],c=e-b-1,d(f[c]))return c;return-1},c.prototype.each=function(a,b){var c,d,e,f,g,h,i,j;if(!p(a))return this;if(null==b&&(b=this),1===a.length)for(i=this.models(),e=0,g=i.length;g>e;e++)d=i[e],a.call(b,d);else for(j=this.models(),c=f=0,h=j.length;h>f;c=++f)d=j[c],a.call(b,c,d);return this},c.prototype.first=function(a){var b,c,d,e;for(a=k(a),p(a)||(a=function(){return!0}),e=this.models(),c=0,d=e.length;d>c;c++)if(b=e[c],a(b))return b;return null},c.prototype.last=function(a){var b,c,d,e,f,g;for(a=k(a),p(a)||(a=function(){return!0}),e=this.models(),d=e.length,b=f=0,g=e.length;g>f;b=++f)if(c=e[b],c=e[d-b-1],a(c))return c;return null},c.prototype.all=function(){return this.models()},c.prototype.filter=function(a){var b;return a=k(a),p(a)?function(){var c,d,e,f;for(e=this.models(),f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f}.call(this):this.models()},c.prototype.any=function(a){var b,c,d,e;if(a=k(a),!p(a))return!1;for(e=this.models(),c=0,d=e.length;d>c;c++)if(b=e[c],a(b))return!0;return!1},c.prototype.without=function(a){var b;return a=k(a),p(a)?function(){var c,d,e,f;for(e=this.models(),f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)||f.push(b);return f}.call(this):this.models()},c.prototype.pluck=function(a,b){var c,d,e,f,g;for(t(a)||(a=""),m(b)||(b=!0),e=[],d=this.models(),f=0,g=d.length;g>f;f++)c=d[f],null!=c?e.push(b?ko.unwrap(c[a]):c[a]):e.push(void 0);return e},c.prototype.slice=function(a,b){return null!=b?this.models.slice(a,b):this.models.slice(a)},d=function(a){function b(){return n=b.__super__.constructor.apply(this,arguments)}return K(b,a),b.prototype.slice=function(){return this.models(b.__super__.slice.apply(this,arguments)),this},b.prototype.filter=function(){return this.models(b.__super__.filter.apply(this,arguments)),this},b.prototype.without=function(){return this.models(b.__super__.without.apply(this,arguments)),this},b}(c),c.prototype.chain=function(){var a;return a=new d,a.model=this.model,a.fill(this.models()),a},c.prototype.mixin=function(b){var c,d,e,f;if(!s(b))return this;for(f=this.models(),d=0,e=f.length;e>d;d++)c=f[d],a.isDataObject(c)&&c.mixin(b);return this.__falcon_collection__mixins__.push(b),this},c.prototype.clone=function(b,c){var d;return(null===b||a.isModel(b))&&(d=[void 0,b],b=d[0],c=d[1]),null===c||a.isModel(c)||(c=this.parent),new this.constructor(this.serialize(b),c)},c.prototype.reset=function(){return this.models([]),this},c.prototype.subscribe=function(a,b,c){return this.models.subscribe(a,b,c)},c}(f),h=function(b){function c(){var b=this;c.__super__.constructor.apply(this,arguments),this.__falcon_view__loaded_template__=ko.observable(),this.__falcon_view__is_rendered__=!1,this.initialize.apply(this,arguments),a.templateAdapter.resolveTemplate(this,function(a){return b.template=a,b.__falcon_view__loaded_template__(a)})}return K(c,b),c.extend=f.extend,c.prototype.endpoint=null,c.prototype.template=null,c.prototype.__falcon_view__loaded_template__=null,c.prototype.__falcon_view__is_rendered__=!1,c.prototype.initialize=function(){},c.prototype.makeUrl=function(){return a.templateAdapter.makeUrl(this)},c.prototype._render=function(){this.__falcon_view__is_rendered__||(this.__falcon_view__is_rendered__=!0,this.display.apply(this,arguments))},c.prototype._unrender=function(){this.__falcon_view__is_rendered__&&(this.__falcon_view__is_rendered__=!1,this.dispose.apply(this,arguments))},c.prototype.initialize=function(){},c.prototype.display=function(){},c.prototype.dispose=function(){},c.__falcon_view__cachedViewModel__=null,c.prototype.createViewModel=function(){var b,c,d;if(null!=this.__falcon_view__cachedViewModel__)return this.__falcon_view__cachedViewModel__;d={};for(b in this)c=this[b],b in a.View.prototype||(p(c)&&!ko.isObservable(c)&&(c=i(c,this)),d[b]=c);return this.__falcon_view__cachedViewModel__=d},c}(f),c=function(a){function b(){return B=b.__super__.constructor.apply(this,arguments)}return K(b,a),b.extend=h.extend,b.prototype.style=null,b.prototype.synchronous=!0,b}(h),this.Falcon=a=new(function(i){function j(){return C=j.__super__.constructor.apply(this,arguments)}return K(j,i),j.prototype.GET="GET",j.prototype.POST="POST",j.prototype.PUT="PUT",j.prototype.DELETE="DELETE",j.prototype.REQUEST_TYPES=["GET","POST","PUT","DELETE"],j.prototype.Object=f,j.prototype.Model=e,j.prototype.Collection=b,j.prototype.View=h,j.prototype.Component=c,j.prototype.DataAdapter=d,j.prototype.TemplateAdapter=g,j.prototype.version="1.0.0rc1",j.prototype.applicationElement="body",j.prototype.baseApiUrl="",j.prototype.baseTemplateUrl="",j.prototype.deferEvaluation=!0,j.prototype.dataAdapter=new d,j.prototype.templateAdapter=new g,j.prototype.ready=function(){var a,b,c,d,e;return e=[],d=function(a){return p(a)?e.push(a):void 0},c=function(){var a,b,c;for(d=function(a){return p(a)?a():void 0},b=0,c=e.length;c>b;b++)a=e[b],a();return e=null},document.addEventListener?document.addEventListener("DOMContentLoaded",b=function(){return c(),document.removeEventListener("DOMContentLoaded",b)}):(a=document.onreadystatechange,document.onreadystatechange=function(){return"complete"===document.readyState&&(c(),document.onreadystatechange=a),p(a)?a.apply(this,arguments):void 0}),function(){return d.apply(null,arguments)}}(),j.prototype.apply=function(b,c,d){var e,f;return p(c)&&(e=[c,null],d=e[0],c=e[1]),!p(b)||ko.isObservable(b)||p(d)||(f=[b,null],d=f[0],b=f[1]),null==c&&(c=a.applicationElement),a.ready(function(){var e;return a.templateAdapter.cacheAllTemplates(),a.templateAdapter.executeLoadRoutines(),n(c)||(t(c)||(c=""),c=o(c)?"body":v(c),c=null!=(e=document.querySelectorAll(c)[0])?e:document.body),null!=b?ko.applyBindingAccessorsToNode(c,{view:function(){return b}}):ko.applyBindings({},c),p(d)?d():void 0}),a},j.prototype.isModel=function(b){return null!=b&&b instanceof a.Model},j.prototype.isCollection=function(b){return null!=b&&b instanceof a.Collection},j.prototype.isView=function(b){return null!=b&&b instanceof a.View},j.prototype.isComponent=function(b){return null!=b&&b instanceof a.Component},j.prototype.isDataObject=function(b){return null!=b&&(b instanceof a.Model||b instanceof a.Collection)},j.prototype.isAdapter=function(b){return null!=b&&b instanceof a.DataAdapter},j.prototype.isFalconObject=function(b){return null!=b&&b instanceof a.Object},j.prototype.addBinding=function(a,b,c){var d;return m(b)&&(d=[c,b],b=d[0],c=d[1]),p(b)&&(b={update:b}),ko.bindingHandlers[a]=b,c&&(ko.virtualElements.allowedBindings[a]=!0),ko.bindingHandlers[a]},j.prototype.getBinding=function(a){return ko.bindingHandlers[a]},j.prototype.addComponent=function(b,c){return s(c)&&!a.isComponent(c.prototype)&&(c=a.Component.extend(c)),ko.components.register(b,{__falcon_component_definition__:c,synchronous:c.prototype.synchronous})},j.prototype.onDispose=function(a,b){return ko.utils.domNodeDisposal.addDisposeCallback(a,b)},j}(f)),ko.components.loaders.unshift(function(){var b,c;return b=null!=(c=document.head)?c:document.getElementsByTagName("head")[0],{loadComponent:function(c,d,e){var f;f=d.__falcon_component_definition__,null!=f&&a.isComponent(f.prototype)?a.templateAdapter.resolveTemplate(f.prototype,function(a){var d,g,h,i,j;return d=document.createElement("div"),d.innerHTML=a,t(f.prototype.style)&&(g=document.createElement("style"),g.innerHTML=f.prototype.style,b.appendChild(g),(h=function(a){var b,d,e,f,g,i,j,k,l;for(f=null!=(j=null!=(k=a.cssRules)?k:a.rules)?j:[],l=[],d=g=0,i=f.length;i>g;d=++g)if(e=f[d],d<f.length&&null!=e)switch(e.type){case CSSRule.STYLE_RULE:b=v(e.cssText),-1===b.indexOf(c)?(a.deleteRule(d),b=""+c+" "+b,l.push(a.insertRule(b,d))):l.push(void 0);break;case CSSRule.MEDIA_RULE:l.push(h(e));break;default:l.push(void 0)}return l})(null!=(i=null!=(j=g.styleSheet)?j:g.sheet)?i:{})),e({synchronous:f.prototype.synchronous,template:k(d.childNodes),createViewModel:function(a){var b;return b=new f(a),a.__falcon_component_view__=b,b._render(),b.createViewModel()}})}):e(null)}}}()),a.addBinding("view",!0,function(){var b,c,d;return c=function(b){var c;return c=b(),(a.isView(c)||ko.isObservable(c))&&(c={data:c}),s(c)||(c={}),null==c.data&&(c.data=null),null==c.displayIf&&(c.displayIf=!0),null==c.afterDisplay&&(c.afterDisplay=null),null==c.beforeDispose&&(c.beforeDispose=null),c},b=function(a,b){var c;return c=ko.computed(function(){return null!=a?a.call(null!=b?b:this):void 0}),c.peek(),c.dispose()},d=function(c){return a.isView(c)&&c.__falcon_view__is_rendered__?b(c._unrender,c):void 0},{init:function(e,f,g,h,i){var j,k,l,m,n,q,r,s,u;return s=null,q=null,m=!1,n=!1,l=function(){},r=null!=(u=e.innerHTML)?u:"",k=document.createElement("div"),j=new ko.templateSources.anonymousTemplate(e),j.nodes(k),j.text(""),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){return d(s)}),ko.computed({disposeWhenNodeIsRemoved:e,read:function(){var g,u,v,w,x,y,z,A;return w=c(f),s=ko.unwrap(w.data),y=a.isView(s)?ko.unwrap(s.__falcon_view__loaded_template__):r,t(y)||(y=r),g=ko.utils.peekObservable(w.afterDisplay),u=ko.utils.peekObservable(w.beforeDispose),x=ko.unwrap(w.displayIf)!==!1,x=x&&!o(y),l=function(){var c,f,o;return l=function(){},n=!1,m=!1,s!==q&&(d(q),q=s),x?(f=a.isView(s)?s.createViewModel():{},c=i.createChildContext(h).extend({$rawView:s,$view:f,$data:f,$root:null!=(o=i.$root)?o:f}),k.innerHTML=y,j.text(y),ko.renderTemplate(e,c,{},e),m=!0,b(null!=s?s._render:void 0,s),p(g)?g(ko.virtualElements.childNodes(e),s):void 0):(d(s),ko.virtualElements.emptyNode(e))},n?void 0:m&&p(u)?(v=null!=(z=null!=(A=u.__falcon_bind__length__)?A:u.length)?z:0,3===v?(n=!0,u(ko.virtualElements.childNodes(e),s,function(){return l()})):2===v?(n=!0,u(ko.virtualElements.childNodes(e),function(){return l()})):(u(ko.virtualElements.childNodes(e),s),l())):l()}}),{controlsDescendantBindings:!0}}}}()),y=function(b){return b=ko.utils.peekObservable(b),(a.isCollection(b)||l(b))&&(b={data:b}),s(b)||(b={}),b.data=ko.unwrap(b.data),a.isCollection(b.data)&&(b.data=b.data.models()),null==b.data&&(b.data=[]),function(){return b}},a.__binding__original_foreach__=null!=(D=a.getBinding("foreach"))?D:{},a.addBinding("foreach",{init:function(){var b,c,d,e,f;return c=arguments[0],e=arguments[1],b=3<=arguments.length?I.call(arguments,2):[],d=ko.unwrap(e()),(f=a.__binding__original_foreach__).init.apply(f,[c,y(d)].concat(I.call(b)))},update:function(){var b,c,d,e,f;return c=arguments[0],e=arguments[1],b=3<=arguments.length?I.call(arguments,2):[],d=ko.unwrap(e()),(f=a.__binding__original_foreach__).update.apply(f,[c,y(d)].concat(I.call(b)))}}),E=a.__binding__original_foreach__;for(u in E)x=E[u],u in ko.bindingHandlers.foreach||(ko.bindingHandlers.foreach[u]=x);
z=function(b){return b=ko.unwrap(b),a.isCollection(b)&&(b=b.models()),function(){return b}},a.__binding__original_options__=null!=(F=a.getBinding("options"))?F:{},a.addBinding("options",{init:function(){var b,c,d,e;return c=arguments[0],d=arguments[1],b=3<=arguments.length?I.call(arguments,2):[],x=ko.unwrap(d()),(null!=(e=a.__binding__original_options__.init)?e:function(){}).apply(null,[c,z(x)].concat(I.call(b)))},update:function(){var b,c,d,e;return c=arguments[0],d=arguments[1],b=3<=arguments.length?I.call(arguments,2):[],x=ko.unwrap(d()),(null!=(e=a.__binding__original_options__.update)?e:function(){}).apply(null,[c,z(x)].concat(I.call(b)))}}),G=a.__binding__original_options__;for(u in G)x=G[u],u in ko.bindingHandlers.options||(ko.bindingHandlers.options[u]=x);a.addBinding("log",!0,function(a,b){return console.log(ko.unwrap(b()))}),a.addBinding("debugger",!0,function(a,b){ko.unwrap(b())}),a.__binding__original_component__=null!=(H=a.getBinding("component"))?H:{},a.addBinding("component",!0,{init:function(b,c){return a.onDispose(b,function(){var b,d;if(s(x=ko.unwrap(c()))&&s(b=x.params)&&a.isView(d=b.__falcon_component_view__))return d._unrender()}),a.__binding__original_component__.init.apply(this,arguments)}}),a.addBinding("yield",!0,{init:function(a,b,c,d,e){var f,g;return g=e.$componentTemplateNodes,f=ko.virtualElements.childNodes(a),ko.computed({disposeWhenNodeIsRemoved:a,read:function(){var c;return x=ko.unwrap(b()),c=x!==!1?k(g):k(f),ko.virtualElements.setDomNodeChildren(a,c),ko.applyBindingsToDescendants(e,a)}}),{controlsDescendantBindings:!0}}})}).call(this);