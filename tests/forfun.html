<html>
	<head>
		<script type="text/javascript" src="lib/knockout-3.1.0.min.js"></script>
		<script type="text/javascript" src="../falcon.min.js"></script>
		<script type="text/javascript" src="../falcon.conductor.min.js"></script>
		<script>
			var Slider = Falcon.Model.extend({
				defaults: {
					'minor_label': "",
					'major_label': ""
				}
			});

			var Sliders = Falcon.Collection.extend({
				model: Slider
			});

			Falcon.addConductor('rex-layout', {
				defaults: {
					'sliders': function() { return new Sliders }
				},

				observables: {
					'background_color': '#ffffff',
					'slider_value': 0,
				},

				addSlider: function() {
					this.sliders.push(new Slider({
						"minor_label": "Calm",
						"major_label": "Raging",
					}));
				},

				removeSlider: function(slider) {
					this.sliders.remove(slider);
				},

				turnBlack: function()
				{
					this.background_color('#000000')
				},

				turnWhite: function()
				{
					this.background_color('#ffffff')
				}
			});

			Falcon.addConductor('rex-header', {
				defaults: {
					options: function(options) {
						return options || {};
					}
				},

				observables: {
					title: ""
				},

				initialize: function(options) {
					if(!options) options = {};
					this.title( options.title || "" );
				},

				leftClick: function() {
					if(this.options.onleftclick) this.options.onleftclick();
				},

				rightClick: function() {
					if(this.options.onrightclick) this.options.onrightclick();
				}
			});

			Falcon.addConductor('rex-slider', {
				url: "#rex-slider-tmpl",

				defaults: {
					'options': null
				},

				observables: {
					'value': 0,
					'left_label': "Some",
					'right_label': "Alot"
				},

				initialize: function(options) {
					options = options || {};
					this.options = options;

					if(ko.isObservable(options.value)) this.value = options.value;
					this.left_label( options.leftlabel || this.left_label() );
					this.right_label( options.rightlabel || this.right_label() );
					this.onremove = options.onremove;
				},

				setValue: function(value) {
					this.value(value)
				},

				valueIs: function(check) {
					return check === this.value()
				},

				remove: function() {
					if(this.options.onremove) this.options.onremove();
					return this;
				}
			});

			Falcon.apply();
		</script>
		<style>
			rex-layout {
				display: block;
				position: relative;
				height: 480px;
				width: 320px;
				border: 1px solid #999;
			}

			rex-header {
				display: block;
				position: absolute;
				top: 0px;
				left: 0px;
				width: 100%;
				height: 40px;
				background-color: #f0f0f0;
				border-bottom: 1px solid #e0e0e0;
			}

			rex-content {
				display: block;
				width: 100%;
				margin-top: 40px;
			}

			rex-slider {
				display: block;
			}

			rex-slider button {
				background-color: #e0e0e0;
			}

			rex-slider button.selected {
				background-color: #ffffff;
			}
		</style>
	</head>
	<body>
		<rex-layout data-bind="style: {'background-color': $self.background_color}">
			<rex-header onleftclick="$view.turnBlack" onrightclick="$view.addSlider" title="My Title">
				<button data-bind="click: $view.leftClick">Left</button>
				<span data-bind="text: title"></span>
				<button data-bind="click: $view.rightClick">Add Slider</button>
			</rex-header>
			<rex-content>
				<!-- ko log: $view --><!-- /ko -->
				<!-- ko foreach: $view.sliders -->
					<rex-slider leftlabel="$data.minor_label" rightlabel="$data.major_label" onremove="$view.removeSlider.bind($view, $data)"></rex-slider>
				<!-- /ko -->
			</rex-content>
		</rex-layout>
	</body>
	<template id="rex-slider-tmpl">
		<label data-bind="text: $view.left_label"></label>
		<button data-bind="click: $view.setValue.bind($data, 1), css: {'selected': $view.valueIs(1)}">1</button>
		<button data-bind="click: $view.setValue.bind($data, 2), css: {'selected': $view.valueIs(2)}">2</button>
		<button data-bind="click: $view.setValue.bind($data, 3), css: {'selected': $view.valueIs(3)}">3</button>
		<button data-bind="click: $view.setValue.bind($data, 4), css: {'selected': $view.valueIs(4)}">4</button>
		<button data-bind="click: $view.setValue.bind($data, 5), css: {'selected': $view.valueIs(5)}">5</button>
		<label data-bind="text: $view.right_label"></label>
		<button data-bind="click: $view.remove">X</button>
	</template>
</html>